<!doctype html><html lang=es-es dir=ltr><head><meta charset=utf-8><meta name=viewport content='width=device-width,initial-scale=1'><meta name=description content="Lee tarjetas NFC para reproducir discos o lo que quieras"><title>Nfc Card Player</title><link rel=canonical href=https://volteret4.github.io/notas/p/nfc-card-player/><link rel=stylesheet href=/notas/scss/style.min.833d6eed45de56f48306bf57268d5b8cdfc8a60e8e7bdc99810464fcd033f7c6.css><meta property='og:title' content="Nfc Card Player"><meta property='og:description' content="Lee tarjetas NFC para reproducir discos o lo que quieras"><meta property='og:url' content='https://volteret4.github.io/notas/p/nfc-card-player/'><meta property='og:site_name' content='memoria digital'><meta property='og:type' content='article'><meta property='article:section' content='Post'><meta property='article:tag' content='m√∫sica'><meta property='article:tag' content='nfc'><meta property='article:published_time' content='2025-12-18T00:00:00+00:00'><meta property='article:modified_time' content='2025-12-18T00:00:00+00:00'><meta name=twitter:title content="Nfc Card Player"><meta name=twitter:description content="Lee tarjetas NFC para reproducir discos o lo que quieras"><link rel="shortcut icon" href=/notas/favicon.ico></head><body class=article-page><script>(function(){const e="StackColorScheme";localStorage.getItem(e)||localStorage.setItem(e,"auto")})()</script><script>(function(){const t="StackColorScheme",e=localStorage.getItem(t),n=window.matchMedia("(prefers-color-scheme: dark)").matches===!0;e=="dark"||e==="auto"&&n?document.documentElement.dataset.scheme="dark":document.documentElement.dataset.scheme="light"})()</script><div class="container main-container flex on-phone--column extended"><aside class="sidebar left-sidebar sticky"><button class="hamburger hamburger--spin" type=button id=toggle-menu aria-label="Ocultar men√∫">
<span class=hamburger-box><span class=hamburger-inner></span></span></button><header><figure class=site-avatar><a href=/notas/><img src=/notas/img/avatar_hu_6e9da9534ffdbc2b.png width=300 height=300 class=site-logo loading=lazy alt=Avatar>
</a><span class=emoji>üêî</span></figure><div class=site-meta><h1 class=site-name><a href=/notas>memoria digital</a></h1><h2 class=site-description>Recopilatorio de notas inform√°ticas.</h2></div></header><ol class=menu-social><li><a href=https://github.com/volteret4 target=_blank title=GitHub rel=me><svg class="icon icon-tabler icon-tabler-brand-github" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z" fill="none"/><path d="M9 19c-4.3 1.4-4.3-2.5-6-3m12 5v-3.5c0-1 .1-1.4-.5-2 2.8-.3 5.5-1.4 5.5-6a4.6 4.6.0 00-1.3-3.2 4.2 4.2.0 00-.1-3.2s-1.1-.3-3.5 1.3a12.3 12.3.0 00-6.2.0C6.5 2.8 5.4 3.1 5.4 3.1a4.2 4.2.0 00-.1 3.2A4.6 4.6.0 004 9.5c0 4.6 2.7 5.7 5.5 6-.6.6-.6 1.2-.5 2V21"/></svg></a></li></ol><ol class=menu id=main-menu><li><a href=/notas/><svg class="icon icon-tabler icon-tabler-home" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><polyline points="5 12 3 12 12 3 21 12 19 12"/><path d="M5 12v7a2 2 0 002 2h10a2 2 0 002-2v-7"/><path d="M9 21v-6a2 2 0 012-2h2a2 2 0 012 2v6"/></svg>
<span>Home</span></a></li><li><a href=/notas/archives/><svg class="icon icon-tabler icon-tabler-archive" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><rect x="3" y="4" width="18" height="4" rx="2"/><path d="M5 8v10a2 2 0 002 2h10a2 2 0 002-2V8"/><line x1="10" y1="12" x2="14" y2="12"/></svg>
<span>Archives</span></a></li><li><a href=/notas/search/><svg class="icon icon-tabler icon-tabler-search" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="10" cy="10" r="7"/><line x1="21" y1="21" x2="15" y2="15"/></svg>
<span>Search</span></a></li><li><a href=/notas/links/><svg class="icon icon-tabler icon-tabler-link" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M10 14a3.5 3.5.0 005 0l4-4a3.5 3.5.0 00-5-5l-.5.5"/><path d="M14 10a3.5 3.5.0 00-5 0l-4 4a3.5 3.5.0 005 5l.5-.5"/></svg>
<span>Links</span></a></li><li class=menu-bottom-section><ol class=menu><li id=dark-mode-toggle><svg class="icon icon-tabler icon-tabler-toggle-left" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="8" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<svg class="icon icon-tabler icon-tabler-toggle-right" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="16" cy="12" r="2"/><rect x="2" y="6" width="20" height="12" rx="6"/></svg>
<span>Modo oscuro</span></li></ol></li></ol></aside><aside class="sidebar right-sidebar sticky"><section class="widget archives"><div class=widget-icon><svg class="icon icon-tabler icon-tabler-hash" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><line x1="5" y1="9" x2="19" y2="9"/><line x1="5" y1="15" x2="19" y2="15"/><line x1="11" y1="4" x2="7" y2="20"/><line x1="17" y1="4" x2="13" y2="20"/></svg></div><h2 class="widget-title section-title">Tabla de contenido</h2><div class=widget--toc><nav id=TableOfContents><ol><li><a href=#instalaci√≥n>Instalaci√≥n</a></li><li><a href=#identificar-tarjetas>Identificar tarjetas</a></li><li><a href=#reaccionar-a-tarjetas>Reaccionar a tarjetas</a><ol><li><a href=#opcional-crea-im√°genes-para-esas-tarjetas>(Opcional) Crea im√°genes para esas tarjetas</a></li></ol></li></ol></nav></div></section></aside><main class="main full-width"><article class=main-article><header class=article-header><div class=article-details><header class=article-category><a href=/notas/categories/apps/>APPS</a></header><div class=article-title-wrapper><h2 class=article-title><a href=/notas/p/nfc-card-player/>Nfc Card Player</a></h2><h3 class=article-subtitle>Lee tarjetas NFC para reproducir discos o lo que quieras</h3></div><footer class=article-time><div><svg class="icon icon-tabler icon-tabler-calendar-time" width="56" height="56" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><path d="M11.795 21H5a2 2 0 01-2-2V7a2 2 0 012-2h12a2 2 0 012 2v4"/><circle cx="18" cy="18" r="4"/><path d="M15 3v4"/><path d="M7 3v4"/><path d="M3 11h16"/><path d="M18 16.496V18l1 1"/></svg>
<time class=article-time--published datetime=2025-12-18T00:00:00Z>dic. 18, 2025</time></div><div><svg class="icon icon-tabler icon-tabler-clock" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><polyline points="12 7 12 12 15 15"/></svg>
<time class=article-time--reading>Tiempo de lectura 32 minutos</time></div></footer></div></header><section class=article-content><blockquote><p>Se ha usado una raspberry 4 con raspbian y un lector NFC ACR122 para este <a class=link href=https://github.com/volteret4/sobrinos target=_blank rel=noopener>proyecto</a></p></blockquote><h2 id=instalaci√≥n>Instalaci√≥n</h2><p>Instala los paquetes necesarios</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo¬†apt-get¬†install¬†libacsccid1¬†pcscd¬†pcsc-tools
</span></span></code></pre></td></tr></table></div></div><p>Activa el demonio que leer√° las tarjetas</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo¬†systemctl¬†<span class=nb>enable</span>¬†‚Äî¬†now¬†pcscd.socket
</span></span></code></pre></td></tr></table></div></div><p>A√±ade estas lineas para desactivar los m√≥dulos nfc del kernel:</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>1
</span><span class=lnt>2
</span><span class=lnt>3
</span><span class=lnt>4
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-bash data-lang=bash><span class=line><span class=cl>sudo¬†nano¬†/etc/modprobe.d/blacklist.conf
</span></span><span class=line><span class=cl><span class=c1># A√±ade estas lineas al final</span>
</span></span><span class=line><span class=cl>install¬†nfc¬†/bin/false
</span></span><span class=line><span class=cl>install¬†pn533¬†/bin/false
</span></span></code></pre></td></tr></table></div></div><p>Ya te deber√≠a permitir leer tarjetas usando <code>pcsc_scan</code>.</p><h2 id=identificar-tarjetas>Identificar tarjetas</h2><p>Con el siguiente script podr√°s obtener el UID de cada tarjeta que mas tarde necesitaremos para reaccionar a las mismas.</p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl><span class=c1># obtener_uid.py</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>smartcard.System</span> <span class=kn>import</span> <span class=n>readers</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>smartcard.util</span> <span class=kn>import</span> <span class=n>toHexString</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>obtener_uid</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># Obtener lista de lectores</span>
</span></span><span class=line><span class=cl>        <span class=n>reader_list</span> <span class=o>=</span> <span class=n>readers</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>reader_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;No se encontraron lectores NFC&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=n>reader</span> <span class=o>=</span> <span class=n>reader_list</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>  <span class=c1># Usar el primer lector</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Usando lector: </span><span class=si>{</span><span class=n>reader</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Acerca una tarjeta al lector...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># Conectar a la tarjeta</span>
</span></span><span class=line><span class=cl>                <span class=n>connection</span> <span class=o>=</span> <span class=n>reader</span><span class=o>.</span><span class=n>createConnection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>connection</span><span class=o>.</span><span class=n>connect</span><span class=p>()</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=c1># Comando APDU para obtener UID</span>
</span></span><span class=line><span class=cl>                <span class=n>command</span> <span class=o>=</span> <span class=p>[</span><span class=mh>0xFF</span><span class=p>,</span> <span class=mh>0xCA</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=n>data</span><span class=p>,</span> <span class=n>sw1</span><span class=p>,</span> <span class=n>sw2</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>transmit</span><span class=p>(</span><span class=n>command</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>sw1</span> <span class=o>==</span> <span class=mh>0x90</span> <span class=ow>and</span> <span class=n>sw2</span> <span class=o>==</span> <span class=mh>0x00</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>uid</span> <span class=o>=</span> <span class=n>toHexString</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;UID detectado: </span><span class=si>{</span><span class=n>uid</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Error al leer la tarjeta&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>                <span class=n>connection</span><span class=o>.</span><span class=n>disconnect</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>KeyboardInterrupt</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>Saliendo...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>obtener_uid</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h2 id=reaccionar-a-tarjetas>Reaccionar a tarjetas</h2><p>Una vez detectadas, podemos editar el siguiente script modificando la parte en que se identifica cada tarjeta con la funci√≥n a realizar.</p><p>En esta ocasi√≥n usaremos moodeaudio para reproducir m√∫sica. Podemos usar el siguiente commando <code>curl</code> para manejar moodeaudio:
<code>curl -G -S -s --data-urlencode "cmd=REST_API_COMMAND" http://moode/command/</code></p><p>Para reproducir un disco especifico usaremos
<code>curl -G -S -s --data-urlencode "cmd=play_item NAS/ruta/al/directorio" http://moode_url/command/</code>
Ej:
<code>curl -G -S -s --data-urlencode "cmd=play_item NAS/moode/moode/M/Mogwai/" http://moode_url/command/</code></p><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt> 1
</span><span class=lnt> 2
</span><span class=lnt> 3
</span><span class=lnt> 4
</span><span class=lnt> 5
</span><span class=lnt> 6
</span><span class=lnt> 7
</span><span class=lnt> 8
</span><span class=lnt> 9
</span><span class=lnt>10
</span><span class=lnt>11
</span><span class=lnt>12
</span><span class=lnt>13
</span><span class=lnt>14
</span><span class=lnt>15
</span><span class=lnt>16
</span><span class=lnt>17
</span><span class=lnt>18
</span><span class=lnt>19
</span><span class=lnt>20
</span><span class=lnt>21
</span><span class=lnt>22
</span><span class=lnt>23
</span><span class=lnt>24
</span><span class=lnt>25
</span><span class=lnt>26
</span><span class=lnt>27
</span><span class=lnt>28
</span><span class=lnt>29
</span><span class=lnt>30
</span><span class=lnt>31
</span><span class=lnt>32
</span><span class=lnt>33
</span><span class=lnt>34
</span><span class=lnt>35
</span><span class=lnt>36
</span><span class=lnt>37
</span><span class=lnt>38
</span><span class=lnt>39
</span><span class=lnt>40
</span><span class=lnt>41
</span><span class=lnt>42
</span><span class=lnt>43
</span><span class=lnt>44
</span><span class=lnt>45
</span><span class=lnt>46
</span><span class=lnt>47
</span><span class=lnt>48
</span><span class=lnt>49
</span><span class=lnt>50
</span><span class=lnt>51
</span><span class=lnt>52
</span><span class=lnt>53
</span><span class=lnt>54
</span><span class=lnt>55
</span><span class=lnt>56
</span><span class=lnt>57
</span><span class=lnt>58
</span><span class=lnt>59
</span><span class=lnt>60
</span><span class=lnt>61
</span><span class=lnt>62
</span><span class=lnt>63
</span><span class=lnt>64
</span><span class=lnt>65
</span><span class=lnt>66
</span><span class=lnt>67
</span><span class=lnt>68
</span><span class=lnt>69
</span><span class=lnt>70
</span><span class=lnt>71
</span><span class=lnt>72
</span><span class=lnt>73
</span><span class=lnt>74
</span><span class=lnt>75
</span><span class=lnt>76
</span><span class=lnt>77
</span><span class=lnt>78
</span><span class=lnt>79
</span><span class=lnt>80
</span><span class=lnt>81
</span><span class=lnt>82
</span><span class=lnt>83
</span><span class=lnt>84
</span><span class=lnt>85
</span><span class=lnt>86
</span><span class=lnt>87
</span><span class=lnt>88
</span><span class=lnt>89
</span><span class=lnt>90
</span><span class=lnt>91
</span><span class=lnt>92
</span><span class=lnt>93
</span><span class=lnt>94
</span><span class=lnt>95
</span><span class=lnt>96
</span><span class=lnt>97
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl><span class=c1># nfc_launcher.py</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>smartcard.System</span> <span class=kn>import</span> <span class=n>readers</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>smartcard.util</span> <span class=kn>import</span> <span class=n>toHexString</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>subprocess</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>time</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Configuraci√≥n de tarjetas y comandos</span>
</span></span><span class=line><span class=cl><span class=n>TARJETAS_CONFIG</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;B2BA9C1E&#34;</span><span class=p>:</span> <span class=p>{</span>  
</span></span><span class=line><span class=cl>        <span class=s2>&#34;nombre&#34;</span><span class=p>:</span> <span class=s2>&#34;Tarjeta 1&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;comando&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;touch&#34;</span><span class=p>,</span> <span class=s2>&#34;/home/pi/sonidos.txt&#34;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;YYYYYYYY&#34;</span><span class=p>:</span> <span class=p>{</span>  <span class=c1># Reemplaza con el UID real de tu tarjeta 2</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;nombre&#34;</span><span class=p>:</span> <span class=s2>&#34;Tarjeta 2&#34;</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>        <span class=s2>&#34;comando&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;curl&#34;</span><span class=p>,</span> <span class=s2>&#34;/home/pi/script1.py&#34;</span><span class=p>],</span>  <span class=c1># Ejemplo: ejecutar script</span>
</span></span><span class=line><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;ZZZZZZZZ&#34;</span><span class=p>:</span> <span class=p>{</span>  <span class=c1># Reemplaza con el UID real de tu tarjeta 3</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;nombre&#34;</span><span class=p>:</span> <span class=s2>&#34;Tarjeta 3&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;comando&#34;</span><span class=p>:</span> <span class=p>[</span><span class=s2>&#34;systemctl&#34;</span><span class=p>,</span> <span class=s2>&#34;restart&#34;</span><span class=p>,</span> <span class=s2>&#34;nginx&#34;</span><span class=p>],</span>  <span class=c1># Ejemplo: reiniciar servicio</span>
</span></span><span class=line><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>ejecutar_comando</span><span class=p>(</span><span class=n>comando</span><span class=p>):</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Ejecuta un comando del sistema&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>resultado</span> <span class=o>=</span> <span class=n>subprocess</span><span class=o>.</span><span class=n>run</span><span class=p>(</span><span class=n>comando</span><span class=p>,</span> <span class=n>capture_output</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>text</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>resultado</span><span class=o>.</span><span class=n>returncode</span> <span class=o>==</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Comando ejecutado exitosamente: </span><span class=si>{</span><span class=s1>&#39; &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>comando</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>resultado</span><span class=o>.</span><span class=n>stdout</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Salida: </span><span class=si>{</span><span class=n>resultado</span><span class=o>.</span><span class=n>stdout</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error ejecutando comando: </span><span class=si>{</span><span class=n>resultado</span><span class=o>.</span><span class=n>stderr</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>monitorear_tarjetas</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Monitorea continuamente las tarjetas NFC&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># Obtener lista de lectores</span>
</span></span><span class=line><span class=cl>        <span class=n>reader_list</span> <span class=o>=</span> <span class=n>readers</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>reader_list</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;No se encontraron lectores NFC&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>reader</span> <span class=o>=</span> <span class=n>reader_list</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Usando lector: </span><span class=si>{</span><span class=n>reader</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Esperando tarjetas... (Ctrl+C para salir)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>ultima_tarjeta</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=n>tiempo_ultima_lectura</span> <span class=o>=</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=kc>True</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># Conectar a la tarjeta</span>
</span></span><span class=line><span class=cl>                <span class=n>connection</span> <span class=o>=</span> <span class=n>reader</span><span class=o>.</span><span class=n>createConnection</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>connection</span><span class=o>.</span><span class=n>connect</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># Obtener UID</span>
</span></span><span class=line><span class=cl>                <span class=n>command</span> <span class=o>=</span> <span class=p>[</span><span class=mh>0xFF</span><span class=p>,</span> <span class=mh>0xCA</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>,</span> <span class=mh>0x00</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=n>data</span><span class=p>,</span> <span class=n>sw1</span><span class=p>,</span> <span class=n>sw2</span> <span class=o>=</span> <span class=n>connection</span><span class=o>.</span><span class=n>transmit</span><span class=p>(</span><span class=n>command</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>sw1</span> <span class=o>==</span> <span class=mh>0x90</span> <span class=ow>and</span> <span class=n>sw2</span> <span class=o>==</span> <span class=mh>0x00</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>uid</span> <span class=o>=</span> <span class=n>toHexString</span><span class=p>(</span><span class=n>data</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>tiempo_actual</span> <span class=o>=</span> <span class=n>time</span><span class=o>.</span><span class=n>time</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># Evitar ejecuciones m√∫ltiples de la misma tarjeta</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=p>(</span><span class=n>uid</span> <span class=o>!=</span> <span class=n>ultima_tarjeta</span> <span class=ow>or</span> 
</span></span><span class=line><span class=cl>                        <span class=n>tiempo_actual</span> <span class=o>-</span> <span class=n>tiempo_ultima_lectura</span> <span class=o>&gt;</span> <span class=mi>3</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                        
</span></span><span class=line><span class=cl>                        <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Tarjeta detectada: </span><span class=si>{</span><span class=n>uid</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=n>uid</span> <span class=ow>in</span> <span class=n>TARJETAS_CONFIG</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                            <span class=n>config</span> <span class=o>=</span> <span class=n>TARJETAS_CONFIG</span><span class=p>[</span><span class=n>uid</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                            <span class=nb>print</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Ejecutando comando para </span><span class=si>{</span><span class=n>config</span><span class=p>[</span><span class=s1>&#39;nombre&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                            <span class=n>ejecutar_comando</span><span class=p>(</span><span class=n>config</span><span class=p>[</span><span class=s1>&#39;comando&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                            <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Tarjeta no configurada&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        
</span></span><span class=line><span class=cl>                        <span class=n>ultima_tarjeta</span> <span class=o>=</span> <span class=n>uid</span>
</span></span><span class=line><span class=cl>                        <span class=n>tiempo_ultima_lectura</span> <span class=o>=</span> <span class=n>tiempo_actual</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>connection</span><span class=o>.</span><span class=n>disconnect</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># La tarjeta se retir√≥ o no hay tarjeta</span>
</span></span><span class=line><span class=cl>                <span class=n>time</span><span class=o>.</span><span class=n>sleep</span><span class=p>(</span><span class=mf>0.5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>KeyboardInterrupt</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;</span><span class=se>\n</span><span class=s2>Saliendo...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>monitorear_tarjetas</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div><h3 id=opcional-crea-im√°genes-para-esas-tarjetas>(Opcional) Crea im√°genes para esas tarjetas</h3><p>Con este script podremos crear imagenes con el tama√±o de las tarjetas (52mmx82mm):
CARA A:</p><ul><li>Portada</li><li>Artista</li><li>Album</li><li>Sello</li><li>Fecha lanzamiento</li><li>G√©nero</li></ul><p>CARA B</p><ul><li>Tracklist</li><li>QR a wikipedia y genius</li></ul><div class=highlight><div class=chroma><table class=lntable><tr><td class=lntd><pre tabindex=0 class=chroma><code><span class=lnt>   1
</span><span class=lnt>   2
</span><span class=lnt>   3
</span><span class=lnt>   4
</span><span class=lnt>   5
</span><span class=lnt>   6
</span><span class=lnt>   7
</span><span class=lnt>   8
</span><span class=lnt>   9
</span><span class=lnt>  10
</span><span class=lnt>  11
</span><span class=lnt>  12
</span><span class=lnt>  13
</span><span class=lnt>  14
</span><span class=lnt>  15
</span><span class=lnt>  16
</span><span class=lnt>  17
</span><span class=lnt>  18
</span><span class=lnt>  19
</span><span class=lnt>  20
</span><span class=lnt>  21
</span><span class=lnt>  22
</span><span class=lnt>  23
</span><span class=lnt>  24
</span><span class=lnt>  25
</span><span class=lnt>  26
</span><span class=lnt>  27
</span><span class=lnt>  28
</span><span class=lnt>  29
</span><span class=lnt>  30
</span><span class=lnt>  31
</span><span class=lnt>  32
</span><span class=lnt>  33
</span><span class=lnt>  34
</span><span class=lnt>  35
</span><span class=lnt>  36
</span><span class=lnt>  37
</span><span class=lnt>  38
</span><span class=lnt>  39
</span><span class=lnt>  40
</span><span class=lnt>  41
</span><span class=lnt>  42
</span><span class=lnt>  43
</span><span class=lnt>  44
</span><span class=lnt>  45
</span><span class=lnt>  46
</span><span class=lnt>  47
</span><span class=lnt>  48
</span><span class=lnt>  49
</span><span class=lnt>  50
</span><span class=lnt>  51
</span><span class=lnt>  52
</span><span class=lnt>  53
</span><span class=lnt>  54
</span><span class=lnt>  55
</span><span class=lnt>  56
</span><span class=lnt>  57
</span><span class=lnt>  58
</span><span class=lnt>  59
</span><span class=lnt>  60
</span><span class=lnt>  61
</span><span class=lnt>  62
</span><span class=lnt>  63
</span><span class=lnt>  64
</span><span class=lnt>  65
</span><span class=lnt>  66
</span><span class=lnt>  67
</span><span class=lnt>  68
</span><span class=lnt>  69
</span><span class=lnt>  70
</span><span class=lnt>  71
</span><span class=lnt>  72
</span><span class=lnt>  73
</span><span class=lnt>  74
</span><span class=lnt>  75
</span><span class=lnt>  76
</span><span class=lnt>  77
</span><span class=lnt>  78
</span><span class=lnt>  79
</span><span class=lnt>  80
</span><span class=lnt>  81
</span><span class=lnt>  82
</span><span class=lnt>  83
</span><span class=lnt>  84
</span><span class=lnt>  85
</span><span class=lnt>  86
</span><span class=lnt>  87
</span><span class=lnt>  88
</span><span class=lnt>  89
</span><span class=lnt>  90
</span><span class=lnt>  91
</span><span class=lnt>  92
</span><span class=lnt>  93
</span><span class=lnt>  94
</span><span class=lnt>  95
</span><span class=lnt>  96
</span><span class=lnt>  97
</span><span class=lnt>  98
</span><span class=lnt>  99
</span><span class=lnt> 100
</span><span class=lnt> 101
</span><span class=lnt> 102
</span><span class=lnt> 103
</span><span class=lnt> 104
</span><span class=lnt> 105
</span><span class=lnt> 106
</span><span class=lnt> 107
</span><span class=lnt> 108
</span><span class=lnt> 109
</span><span class=lnt> 110
</span><span class=lnt> 111
</span><span class=lnt> 112
</span><span class=lnt> 113
</span><span class=lnt> 114
</span><span class=lnt> 115
</span><span class=lnt> 116
</span><span class=lnt> 117
</span><span class=lnt> 118
</span><span class=lnt> 119
</span><span class=lnt> 120
</span><span class=lnt> 121
</span><span class=lnt> 122
</span><span class=lnt> 123
</span><span class=lnt> 124
</span><span class=lnt> 125
</span><span class=lnt> 126
</span><span class=lnt> 127
</span><span class=lnt> 128
</span><span class=lnt> 129
</span><span class=lnt> 130
</span><span class=lnt> 131
</span><span class=lnt> 132
</span><span class=lnt> 133
</span><span class=lnt> 134
</span><span class=lnt> 135
</span><span class=lnt> 136
</span><span class=lnt> 137
</span><span class=lnt> 138
</span><span class=lnt> 139
</span><span class=lnt> 140
</span><span class=lnt> 141
</span><span class=lnt> 142
</span><span class=lnt> 143
</span><span class=lnt> 144
</span><span class=lnt> 145
</span><span class=lnt> 146
</span><span class=lnt> 147
</span><span class=lnt> 148
</span><span class=lnt> 149
</span><span class=lnt> 150
</span><span class=lnt> 151
</span><span class=lnt> 152
</span><span class=lnt> 153
</span><span class=lnt> 154
</span><span class=lnt> 155
</span><span class=lnt> 156
</span><span class=lnt> 157
</span><span class=lnt> 158
</span><span class=lnt> 159
</span><span class=lnt> 160
</span><span class=lnt> 161
</span><span class=lnt> 162
</span><span class=lnt> 163
</span><span class=lnt> 164
</span><span class=lnt> 165
</span><span class=lnt> 166
</span><span class=lnt> 167
</span><span class=lnt> 168
</span><span class=lnt> 169
</span><span class=lnt> 170
</span><span class=lnt> 171
</span><span class=lnt> 172
</span><span class=lnt> 173
</span><span class=lnt> 174
</span><span class=lnt> 175
</span><span class=lnt> 176
</span><span class=lnt> 177
</span><span class=lnt> 178
</span><span class=lnt> 179
</span><span class=lnt> 180
</span><span class=lnt> 181
</span><span class=lnt> 182
</span><span class=lnt> 183
</span><span class=lnt> 184
</span><span class=lnt> 185
</span><span class=lnt> 186
</span><span class=lnt> 187
</span><span class=lnt> 188
</span><span class=lnt> 189
</span><span class=lnt> 190
</span><span class=lnt> 191
</span><span class=lnt> 192
</span><span class=lnt> 193
</span><span class=lnt> 194
</span><span class=lnt> 195
</span><span class=lnt> 196
</span><span class=lnt> 197
</span><span class=lnt> 198
</span><span class=lnt> 199
</span><span class=lnt> 200
</span><span class=lnt> 201
</span><span class=lnt> 202
</span><span class=lnt> 203
</span><span class=lnt> 204
</span><span class=lnt> 205
</span><span class=lnt> 206
</span><span class=lnt> 207
</span><span class=lnt> 208
</span><span class=lnt> 209
</span><span class=lnt> 210
</span><span class=lnt> 211
</span><span class=lnt> 212
</span><span class=lnt> 213
</span><span class=lnt> 214
</span><span class=lnt> 215
</span><span class=lnt> 216
</span><span class=lnt> 217
</span><span class=lnt> 218
</span><span class=lnt> 219
</span><span class=lnt> 220
</span><span class=lnt> 221
</span><span class=lnt> 222
</span><span class=lnt> 223
</span><span class=lnt> 224
</span><span class=lnt> 225
</span><span class=lnt> 226
</span><span class=lnt> 227
</span><span class=lnt> 228
</span><span class=lnt> 229
</span><span class=lnt> 230
</span><span class=lnt> 231
</span><span class=lnt> 232
</span><span class=lnt> 233
</span><span class=lnt> 234
</span><span class=lnt> 235
</span><span class=lnt> 236
</span><span class=lnt> 237
</span><span class=lnt> 238
</span><span class=lnt> 239
</span><span class=lnt> 240
</span><span class=lnt> 241
</span><span class=lnt> 242
</span><span class=lnt> 243
</span><span class=lnt> 244
</span><span class=lnt> 245
</span><span class=lnt> 246
</span><span class=lnt> 247
</span><span class=lnt> 248
</span><span class=lnt> 249
</span><span class=lnt> 250
</span><span class=lnt> 251
</span><span class=lnt> 252
</span><span class=lnt> 253
</span><span class=lnt> 254
</span><span class=lnt> 255
</span><span class=lnt> 256
</span><span class=lnt> 257
</span><span class=lnt> 258
</span><span class=lnt> 259
</span><span class=lnt> 260
</span><span class=lnt> 261
</span><span class=lnt> 262
</span><span class=lnt> 263
</span><span class=lnt> 264
</span><span class=lnt> 265
</span><span class=lnt> 266
</span><span class=lnt> 267
</span><span class=lnt> 268
</span><span class=lnt> 269
</span><span class=lnt> 270
</span><span class=lnt> 271
</span><span class=lnt> 272
</span><span class=lnt> 273
</span><span class=lnt> 274
</span><span class=lnt> 275
</span><span class=lnt> 276
</span><span class=lnt> 277
</span><span class=lnt> 278
</span><span class=lnt> 279
</span><span class=lnt> 280
</span><span class=lnt> 281
</span><span class=lnt> 282
</span><span class=lnt> 283
</span><span class=lnt> 284
</span><span class=lnt> 285
</span><span class=lnt> 286
</span><span class=lnt> 287
</span><span class=lnt> 288
</span><span class=lnt> 289
</span><span class=lnt> 290
</span><span class=lnt> 291
</span><span class=lnt> 292
</span><span class=lnt> 293
</span><span class=lnt> 294
</span><span class=lnt> 295
</span><span class=lnt> 296
</span><span class=lnt> 297
</span><span class=lnt> 298
</span><span class=lnt> 299
</span><span class=lnt> 300
</span><span class=lnt> 301
</span><span class=lnt> 302
</span><span class=lnt> 303
</span><span class=lnt> 304
</span><span class=lnt> 305
</span><span class=lnt> 306
</span><span class=lnt> 307
</span><span class=lnt> 308
</span><span class=lnt> 309
</span><span class=lnt> 310
</span><span class=lnt> 311
</span><span class=lnt> 312
</span><span class=lnt> 313
</span><span class=lnt> 314
</span><span class=lnt> 315
</span><span class=lnt> 316
</span><span class=lnt> 317
</span><span class=lnt> 318
</span><span class=lnt> 319
</span><span class=lnt> 320
</span><span class=lnt> 321
</span><span class=lnt> 322
</span><span class=lnt> 323
</span><span class=lnt> 324
</span><span class=lnt> 325
</span><span class=lnt> 326
</span><span class=lnt> 327
</span><span class=lnt> 328
</span><span class=lnt> 329
</span><span class=lnt> 330
</span><span class=lnt> 331
</span><span class=lnt> 332
</span><span class=lnt> 333
</span><span class=lnt> 334
</span><span class=lnt> 335
</span><span class=lnt> 336
</span><span class=lnt> 337
</span><span class=lnt> 338
</span><span class=lnt> 339
</span><span class=lnt> 340
</span><span class=lnt> 341
</span><span class=lnt> 342
</span><span class=lnt> 343
</span><span class=lnt> 344
</span><span class=lnt> 345
</span><span class=lnt> 346
</span><span class=lnt> 347
</span><span class=lnt> 348
</span><span class=lnt> 349
</span><span class=lnt> 350
</span><span class=lnt> 351
</span><span class=lnt> 352
</span><span class=lnt> 353
</span><span class=lnt> 354
</span><span class=lnt> 355
</span><span class=lnt> 356
</span><span class=lnt> 357
</span><span class=lnt> 358
</span><span class=lnt> 359
</span><span class=lnt> 360
</span><span class=lnt> 361
</span><span class=lnt> 362
</span><span class=lnt> 363
</span><span class=lnt> 364
</span><span class=lnt> 365
</span><span class=lnt> 366
</span><span class=lnt> 367
</span><span class=lnt> 368
</span><span class=lnt> 369
</span><span class=lnt> 370
</span><span class=lnt> 371
</span><span class=lnt> 372
</span><span class=lnt> 373
</span><span class=lnt> 374
</span><span class=lnt> 375
</span><span class=lnt> 376
</span><span class=lnt> 377
</span><span class=lnt> 378
</span><span class=lnt> 379
</span><span class=lnt> 380
</span><span class=lnt> 381
</span><span class=lnt> 382
</span><span class=lnt> 383
</span><span class=lnt> 384
</span><span class=lnt> 385
</span><span class=lnt> 386
</span><span class=lnt> 387
</span><span class=lnt> 388
</span><span class=lnt> 389
</span><span class=lnt> 390
</span><span class=lnt> 391
</span><span class=lnt> 392
</span><span class=lnt> 393
</span><span class=lnt> 394
</span><span class=lnt> 395
</span><span class=lnt> 396
</span><span class=lnt> 397
</span><span class=lnt> 398
</span><span class=lnt> 399
</span><span class=lnt> 400
</span><span class=lnt> 401
</span><span class=lnt> 402
</span><span class=lnt> 403
</span><span class=lnt> 404
</span><span class=lnt> 405
</span><span class=lnt> 406
</span><span class=lnt> 407
</span><span class=lnt> 408
</span><span class=lnt> 409
</span><span class=lnt> 410
</span><span class=lnt> 411
</span><span class=lnt> 412
</span><span class=lnt> 413
</span><span class=lnt> 414
</span><span class=lnt> 415
</span><span class=lnt> 416
</span><span class=lnt> 417
</span><span class=lnt> 418
</span><span class=lnt> 419
</span><span class=lnt> 420
</span><span class=lnt> 421
</span><span class=lnt> 422
</span><span class=lnt> 423
</span><span class=lnt> 424
</span><span class=lnt> 425
</span><span class=lnt> 426
</span><span class=lnt> 427
</span><span class=lnt> 428
</span><span class=lnt> 429
</span><span class=lnt> 430
</span><span class=lnt> 431
</span><span class=lnt> 432
</span><span class=lnt> 433
</span><span class=lnt> 434
</span><span class=lnt> 435
</span><span class=lnt> 436
</span><span class=lnt> 437
</span><span class=lnt> 438
</span><span class=lnt> 439
</span><span class=lnt> 440
</span><span class=lnt> 441
</span><span class=lnt> 442
</span><span class=lnt> 443
</span><span class=lnt> 444
</span><span class=lnt> 445
</span><span class=lnt> 446
</span><span class=lnt> 447
</span><span class=lnt> 448
</span><span class=lnt> 449
</span><span class=lnt> 450
</span><span class=lnt> 451
</span><span class=lnt> 452
</span><span class=lnt> 453
</span><span class=lnt> 454
</span><span class=lnt> 455
</span><span class=lnt> 456
</span><span class=lnt> 457
</span><span class=lnt> 458
</span><span class=lnt> 459
</span><span class=lnt> 460
</span><span class=lnt> 461
</span><span class=lnt> 462
</span><span class=lnt> 463
</span><span class=lnt> 464
</span><span class=lnt> 465
</span><span class=lnt> 466
</span><span class=lnt> 467
</span><span class=lnt> 468
</span><span class=lnt> 469
</span><span class=lnt> 470
</span><span class=lnt> 471
</span><span class=lnt> 472
</span><span class=lnt> 473
</span><span class=lnt> 474
</span><span class=lnt> 475
</span><span class=lnt> 476
</span><span class=lnt> 477
</span><span class=lnt> 478
</span><span class=lnt> 479
</span><span class=lnt> 480
</span><span class=lnt> 481
</span><span class=lnt> 482
</span><span class=lnt> 483
</span><span class=lnt> 484
</span><span class=lnt> 485
</span><span class=lnt> 486
</span><span class=lnt> 487
</span><span class=lnt> 488
</span><span class=lnt> 489
</span><span class=lnt> 490
</span><span class=lnt> 491
</span><span class=lnt> 492
</span><span class=lnt> 493
</span><span class=lnt> 494
</span><span class=lnt> 495
</span><span class=lnt> 496
</span><span class=lnt> 497
</span><span class=lnt> 498
</span><span class=lnt> 499
</span><span class=lnt> 500
</span><span class=lnt> 501
</span><span class=lnt> 502
</span><span class=lnt> 503
</span><span class=lnt> 504
</span><span class=lnt> 505
</span><span class=lnt> 506
</span><span class=lnt> 507
</span><span class=lnt> 508
</span><span class=lnt> 509
</span><span class=lnt> 510
</span><span class=lnt> 511
</span><span class=lnt> 512
</span><span class=lnt> 513
</span><span class=lnt> 514
</span><span class=lnt> 515
</span><span class=lnt> 516
</span><span class=lnt> 517
</span><span class=lnt> 518
</span><span class=lnt> 519
</span><span class=lnt> 520
</span><span class=lnt> 521
</span><span class=lnt> 522
</span><span class=lnt> 523
</span><span class=lnt> 524
</span><span class=lnt> 525
</span><span class=lnt> 526
</span><span class=lnt> 527
</span><span class=lnt> 528
</span><span class=lnt> 529
</span><span class=lnt> 530
</span><span class=lnt> 531
</span><span class=lnt> 532
</span><span class=lnt> 533
</span><span class=lnt> 534
</span><span class=lnt> 535
</span><span class=lnt> 536
</span><span class=lnt> 537
</span><span class=lnt> 538
</span><span class=lnt> 539
</span><span class=lnt> 540
</span><span class=lnt> 541
</span><span class=lnt> 542
</span><span class=lnt> 543
</span><span class=lnt> 544
</span><span class=lnt> 545
</span><span class=lnt> 546
</span><span class=lnt> 547
</span><span class=lnt> 548
</span><span class=lnt> 549
</span><span class=lnt> 550
</span><span class=lnt> 551
</span><span class=lnt> 552
</span><span class=lnt> 553
</span><span class=lnt> 554
</span><span class=lnt> 555
</span><span class=lnt> 556
</span><span class=lnt> 557
</span><span class=lnt> 558
</span><span class=lnt> 559
</span><span class=lnt> 560
</span><span class=lnt> 561
</span><span class=lnt> 562
</span><span class=lnt> 563
</span><span class=lnt> 564
</span><span class=lnt> 565
</span><span class=lnt> 566
</span><span class=lnt> 567
</span><span class=lnt> 568
</span><span class=lnt> 569
</span><span class=lnt> 570
</span><span class=lnt> 571
</span><span class=lnt> 572
</span><span class=lnt> 573
</span><span class=lnt> 574
</span><span class=lnt> 575
</span><span class=lnt> 576
</span><span class=lnt> 577
</span><span class=lnt> 578
</span><span class=lnt> 579
</span><span class=lnt> 580
</span><span class=lnt> 581
</span><span class=lnt> 582
</span><span class=lnt> 583
</span><span class=lnt> 584
</span><span class=lnt> 585
</span><span class=lnt> 586
</span><span class=lnt> 587
</span><span class=lnt> 588
</span><span class=lnt> 589
</span><span class=lnt> 590
</span><span class=lnt> 591
</span><span class=lnt> 592
</span><span class=lnt> 593
</span><span class=lnt> 594
</span><span class=lnt> 595
</span><span class=lnt> 596
</span><span class=lnt> 597
</span><span class=lnt> 598
</span><span class=lnt> 599
</span><span class=lnt> 600
</span><span class=lnt> 601
</span><span class=lnt> 602
</span><span class=lnt> 603
</span><span class=lnt> 604
</span><span class=lnt> 605
</span><span class=lnt> 606
</span><span class=lnt> 607
</span><span class=lnt> 608
</span><span class=lnt> 609
</span><span class=lnt> 610
</span><span class=lnt> 611
</span><span class=lnt> 612
</span><span class=lnt> 613
</span><span class=lnt> 614
</span><span class=lnt> 615
</span><span class=lnt> 616
</span><span class=lnt> 617
</span><span class=lnt> 618
</span><span class=lnt> 619
</span><span class=lnt> 620
</span><span class=lnt> 621
</span><span class=lnt> 622
</span><span class=lnt> 623
</span><span class=lnt> 624
</span><span class=lnt> 625
</span><span class=lnt> 626
</span><span class=lnt> 627
</span><span class=lnt> 628
</span><span class=lnt> 629
</span><span class=lnt> 630
</span><span class=lnt> 631
</span><span class=lnt> 632
</span><span class=lnt> 633
</span><span class=lnt> 634
</span><span class=lnt> 635
</span><span class=lnt> 636
</span><span class=lnt> 637
</span><span class=lnt> 638
</span><span class=lnt> 639
</span><span class=lnt> 640
</span><span class=lnt> 641
</span><span class=lnt> 642
</span><span class=lnt> 643
</span><span class=lnt> 644
</span><span class=lnt> 645
</span><span class=lnt> 646
</span><span class=lnt> 647
</span><span class=lnt> 648
</span><span class=lnt> 649
</span><span class=lnt> 650
</span><span class=lnt> 651
</span><span class=lnt> 652
</span><span class=lnt> 653
</span><span class=lnt> 654
</span><span class=lnt> 655
</span><span class=lnt> 656
</span><span class=lnt> 657
</span><span class=lnt> 658
</span><span class=lnt> 659
</span><span class=lnt> 660
</span><span class=lnt> 661
</span><span class=lnt> 662
</span><span class=lnt> 663
</span><span class=lnt> 664
</span><span class=lnt> 665
</span><span class=lnt> 666
</span><span class=lnt> 667
</span><span class=lnt> 668
</span><span class=lnt> 669
</span><span class=lnt> 670
</span><span class=lnt> 671
</span><span class=lnt> 672
</span><span class=lnt> 673
</span><span class=lnt> 674
</span><span class=lnt> 675
</span><span class=lnt> 676
</span><span class=lnt> 677
</span><span class=lnt> 678
</span><span class=lnt> 679
</span><span class=lnt> 680
</span><span class=lnt> 681
</span><span class=lnt> 682
</span><span class=lnt> 683
</span><span class=lnt> 684
</span><span class=lnt> 685
</span><span class=lnt> 686
</span><span class=lnt> 687
</span><span class=lnt> 688
</span><span class=lnt> 689
</span><span class=lnt> 690
</span><span class=lnt> 691
</span><span class=lnt> 692
</span><span class=lnt> 693
</span><span class=lnt> 694
</span><span class=lnt> 695
</span><span class=lnt> 696
</span><span class=lnt> 697
</span><span class=lnt> 698
</span><span class=lnt> 699
</span><span class=lnt> 700
</span><span class=lnt> 701
</span><span class=lnt> 702
</span><span class=lnt> 703
</span><span class=lnt> 704
</span><span class=lnt> 705
</span><span class=lnt> 706
</span><span class=lnt> 707
</span><span class=lnt> 708
</span><span class=lnt> 709
</span><span class=lnt> 710
</span><span class=lnt> 711
</span><span class=lnt> 712
</span><span class=lnt> 713
</span><span class=lnt> 714
</span><span class=lnt> 715
</span><span class=lnt> 716
</span><span class=lnt> 717
</span><span class=lnt> 718
</span><span class=lnt> 719
</span><span class=lnt> 720
</span><span class=lnt> 721
</span><span class=lnt> 722
</span><span class=lnt> 723
</span><span class=lnt> 724
</span><span class=lnt> 725
</span><span class=lnt> 726
</span><span class=lnt> 727
</span><span class=lnt> 728
</span><span class=lnt> 729
</span><span class=lnt> 730
</span><span class=lnt> 731
</span><span class=lnt> 732
</span><span class=lnt> 733
</span><span class=lnt> 734
</span><span class=lnt> 735
</span><span class=lnt> 736
</span><span class=lnt> 737
</span><span class=lnt> 738
</span><span class=lnt> 739
</span><span class=lnt> 740
</span><span class=lnt> 741
</span><span class=lnt> 742
</span><span class=lnt> 743
</span><span class=lnt> 744
</span><span class=lnt> 745
</span><span class=lnt> 746
</span><span class=lnt> 747
</span><span class=lnt> 748
</span><span class=lnt> 749
</span><span class=lnt> 750
</span><span class=lnt> 751
</span><span class=lnt> 752
</span><span class=lnt> 753
</span><span class=lnt> 754
</span><span class=lnt> 755
</span><span class=lnt> 756
</span><span class=lnt> 757
</span><span class=lnt> 758
</span><span class=lnt> 759
</span><span class=lnt> 760
</span><span class=lnt> 761
</span><span class=lnt> 762
</span><span class=lnt> 763
</span><span class=lnt> 764
</span><span class=lnt> 765
</span><span class=lnt> 766
</span><span class=lnt> 767
</span><span class=lnt> 768
</span><span class=lnt> 769
</span><span class=lnt> 770
</span><span class=lnt> 771
</span><span class=lnt> 772
</span><span class=lnt> 773
</span><span class=lnt> 774
</span><span class=lnt> 775
</span><span class=lnt> 776
</span><span class=lnt> 777
</span><span class=lnt> 778
</span><span class=lnt> 779
</span><span class=lnt> 780
</span><span class=lnt> 781
</span><span class=lnt> 782
</span><span class=lnt> 783
</span><span class=lnt> 784
</span><span class=lnt> 785
</span><span class=lnt> 786
</span><span class=lnt> 787
</span><span class=lnt> 788
</span><span class=lnt> 789
</span><span class=lnt> 790
</span><span class=lnt> 791
</span><span class=lnt> 792
</span><span class=lnt> 793
</span><span class=lnt> 794
</span><span class=lnt> 795
</span><span class=lnt> 796
</span><span class=lnt> 797
</span><span class=lnt> 798
</span><span class=lnt> 799
</span><span class=lnt> 800
</span><span class=lnt> 801
</span><span class=lnt> 802
</span><span class=lnt> 803
</span><span class=lnt> 804
</span><span class=lnt> 805
</span><span class=lnt> 806
</span><span class=lnt> 807
</span><span class=lnt> 808
</span><span class=lnt> 809
</span><span class=lnt> 810
</span><span class=lnt> 811
</span><span class=lnt> 812
</span><span class=lnt> 813
</span><span class=lnt> 814
</span><span class=lnt> 815
</span><span class=lnt> 816
</span><span class=lnt> 817
</span><span class=lnt> 818
</span><span class=lnt> 819
</span><span class=lnt> 820
</span><span class=lnt> 821
</span><span class=lnt> 822
</span><span class=lnt> 823
</span><span class=lnt> 824
</span><span class=lnt> 825
</span><span class=lnt> 826
</span><span class=lnt> 827
</span><span class=lnt> 828
</span><span class=lnt> 829
</span><span class=lnt> 830
</span><span class=lnt> 831
</span><span class=lnt> 832
</span><span class=lnt> 833
</span><span class=lnt> 834
</span><span class=lnt> 835
</span><span class=lnt> 836
</span><span class=lnt> 837
</span><span class=lnt> 838
</span><span class=lnt> 839
</span><span class=lnt> 840
</span><span class=lnt> 841
</span><span class=lnt> 842
</span><span class=lnt> 843
</span><span class=lnt> 844
</span><span class=lnt> 845
</span><span class=lnt> 846
</span><span class=lnt> 847
</span><span class=lnt> 848
</span><span class=lnt> 849
</span><span class=lnt> 850
</span><span class=lnt> 851
</span><span class=lnt> 852
</span><span class=lnt> 853
</span><span class=lnt> 854
</span><span class=lnt> 855
</span><span class=lnt> 856
</span><span class=lnt> 857
</span><span class=lnt> 858
</span><span class=lnt> 859
</span><span class=lnt> 860
</span><span class=lnt> 861
</span><span class=lnt> 862
</span><span class=lnt> 863
</span><span class=lnt> 864
</span><span class=lnt> 865
</span><span class=lnt> 866
</span><span class=lnt> 867
</span><span class=lnt> 868
</span><span class=lnt> 869
</span><span class=lnt> 870
</span><span class=lnt> 871
</span><span class=lnt> 872
</span><span class=lnt> 873
</span><span class=lnt> 874
</span><span class=lnt> 875
</span><span class=lnt> 876
</span><span class=lnt> 877
</span><span class=lnt> 878
</span><span class=lnt> 879
</span><span class=lnt> 880
</span><span class=lnt> 881
</span><span class=lnt> 882
</span><span class=lnt> 883
</span><span class=lnt> 884
</span><span class=lnt> 885
</span><span class=lnt> 886
</span><span class=lnt> 887
</span><span class=lnt> 888
</span><span class=lnt> 889
</span><span class=lnt> 890
</span><span class=lnt> 891
</span><span class=lnt> 892
</span><span class=lnt> 893
</span><span class=lnt> 894
</span><span class=lnt> 895
</span><span class=lnt> 896
</span><span class=lnt> 897
</span><span class=lnt> 898
</span><span class=lnt> 899
</span><span class=lnt> 900
</span><span class=lnt> 901
</span><span class=lnt> 902
</span><span class=lnt> 903
</span><span class=lnt> 904
</span><span class=lnt> 905
</span><span class=lnt> 906
</span><span class=lnt> 907
</span><span class=lnt> 908
</span><span class=lnt> 909
</span><span class=lnt> 910
</span><span class=lnt> 911
</span><span class=lnt> 912
</span><span class=lnt> 913
</span><span class=lnt> 914
</span><span class=lnt> 915
</span><span class=lnt> 916
</span><span class=lnt> 917
</span><span class=lnt> 918
</span><span class=lnt> 919
</span><span class=lnt> 920
</span><span class=lnt> 921
</span><span class=lnt> 922
</span><span class=lnt> 923
</span><span class=lnt> 924
</span><span class=lnt> 925
</span><span class=lnt> 926
</span><span class=lnt> 927
</span><span class=lnt> 928
</span><span class=lnt> 929
</span><span class=lnt> 930
</span><span class=lnt> 931
</span><span class=lnt> 932
</span><span class=lnt> 933
</span><span class=lnt> 934
</span><span class=lnt> 935
</span><span class=lnt> 936
</span><span class=lnt> 937
</span><span class=lnt> 938
</span><span class=lnt> 939
</span><span class=lnt> 940
</span><span class=lnt> 941
</span><span class=lnt> 942
</span><span class=lnt> 943
</span><span class=lnt> 944
</span><span class=lnt> 945
</span><span class=lnt> 946
</span><span class=lnt> 947
</span><span class=lnt> 948
</span><span class=lnt> 949
</span><span class=lnt> 950
</span><span class=lnt> 951
</span><span class=lnt> 952
</span><span class=lnt> 953
</span><span class=lnt> 954
</span><span class=lnt> 955
</span><span class=lnt> 956
</span><span class=lnt> 957
</span><span class=lnt> 958
</span><span class=lnt> 959
</span><span class=lnt> 960
</span><span class=lnt> 961
</span><span class=lnt> 962
</span><span class=lnt> 963
</span><span class=lnt> 964
</span><span class=lnt> 965
</span><span class=lnt> 966
</span><span class=lnt> 967
</span><span class=lnt> 968
</span><span class=lnt> 969
</span><span class=lnt> 970
</span><span class=lnt> 971
</span><span class=lnt> 972
</span><span class=lnt> 973
</span><span class=lnt> 974
</span><span class=lnt> 975
</span><span class=lnt> 976
</span><span class=lnt> 977
</span><span class=lnt> 978
</span><span class=lnt> 979
</span><span class=lnt> 980
</span><span class=lnt> 981
</span><span class=lnt> 982
</span><span class=lnt> 983
</span><span class=lnt> 984
</span><span class=lnt> 985
</span><span class=lnt> 986
</span><span class=lnt> 987
</span><span class=lnt> 988
</span><span class=lnt> 989
</span><span class=lnt> 990
</span><span class=lnt> 991
</span><span class=lnt> 992
</span><span class=lnt> 993
</span><span class=lnt> 994
</span><span class=lnt> 995
</span><span class=lnt> 996
</span><span class=lnt> 997
</span><span class=lnt> 998
</span><span class=lnt> 999
</span><span class=lnt>1000
</span><span class=lnt>1001
</span><span class=lnt>1002
</span><span class=lnt>1003
</span><span class=lnt>1004
</span><span class=lnt>1005
</span><span class=lnt>1006
</span><span class=lnt>1007
</span><span class=lnt>1008
</span><span class=lnt>1009
</span><span class=lnt>1010
</span><span class=lnt>1011
</span><span class=lnt>1012
</span><span class=lnt>1013
</span><span class=lnt>1014
</span><span class=lnt>1015
</span><span class=lnt>1016
</span><span class=lnt>1017
</span><span class=lnt>1018
</span><span class=lnt>1019
</span><span class=lnt>1020
</span><span class=lnt>1021
</span><span class=lnt>1022
</span><span class=lnt>1023
</span><span class=lnt>1024
</span><span class=lnt>1025
</span><span class=lnt>1026
</span><span class=lnt>1027
</span><span class=lnt>1028
</span><span class=lnt>1029
</span><span class=lnt>1030
</span><span class=lnt>1031
</span><span class=lnt>1032
</span><span class=lnt>1033
</span><span class=lnt>1034
</span><span class=lnt>1035
</span><span class=lnt>1036
</span><span class=lnt>1037
</span><span class=lnt>1038
</span><span class=lnt>1039
</span><span class=lnt>1040
</span><span class=lnt>1041
</span><span class=lnt>1042
</span><span class=lnt>1043
</span><span class=lnt>1044
</span><span class=lnt>1045
</span><span class=lnt>1046
</span><span class=lnt>1047
</span><span class=lnt>1048
</span><span class=lnt>1049
</span><span class=lnt>1050
</span><span class=lnt>1051
</span><span class=lnt>1052
</span><span class=lnt>1053
</span><span class=lnt>1054
</span><span class=lnt>1055
</span><span class=lnt>1056
</span><span class=lnt>1057
</span><span class=lnt>1058
</span><span class=lnt>1059
</span><span class=lnt>1060
</span><span class=lnt>1061
</span><span class=lnt>1062
</span><span class=lnt>1063
</span><span class=lnt>1064
</span><span class=lnt>1065
</span><span class=lnt>1066
</span><span class=lnt>1067
</span><span class=lnt>1068
</span><span class=lnt>1069
</span><span class=lnt>1070
</span><span class=lnt>1071
</span><span class=lnt>1072
</span><span class=lnt>1073
</span><span class=lnt>1074
</span><span class=lnt>1075
</span><span class=lnt>1076
</span><span class=lnt>1077
</span><span class=lnt>1078
</span><span class=lnt>1079
</span><span class=lnt>1080
</span><span class=lnt>1081
</span><span class=lnt>1082
</span><span class=lnt>1083
</span><span class=lnt>1084
</span><span class=lnt>1085
</span><span class=lnt>1086
</span><span class=lnt>1087
</span><span class=lnt>1088
</span><span class=lnt>1089
</span><span class=lnt>1090
</span><span class=lnt>1091
</span><span class=lnt>1092
</span><span class=lnt>1093
</span><span class=lnt>1094
</span><span class=lnt>1095
</span><span class=lnt>1096
</span><span class=lnt>1097
</span><span class=lnt>1098
</span><span class=lnt>1099
</span><span class=lnt>1100
</span><span class=lnt>1101
</span><span class=lnt>1102
</span><span class=lnt>1103
</span><span class=lnt>1104
</span><span class=lnt>1105
</span><span class=lnt>1106
</span><span class=lnt>1107
</span><span class=lnt>1108
</span><span class=lnt>1109
</span><span class=lnt>1110
</span><span class=lnt>1111
</span><span class=lnt>1112
</span><span class=lnt>1113
</span><span class=lnt>1114
</span><span class=lnt>1115
</span><span class=lnt>1116
</span><span class=lnt>1117
</span><span class=lnt>1118
</span><span class=lnt>1119
</span><span class=lnt>1120
</span><span class=lnt>1121
</span><span class=lnt>1122
</span><span class=lnt>1123
</span><span class=lnt>1124
</span><span class=lnt>1125
</span><span class=lnt>1126
</span><span class=lnt>1127
</span><span class=lnt>1128
</span><span class=lnt>1129
</span><span class=lnt>1130
</span><span class=lnt>1131
</span><span class=lnt>1132
</span><span class=lnt>1133
</span><span class=lnt>1134
</span><span class=lnt>1135
</span><span class=lnt>1136
</span><span class=lnt>1137
</span><span class=lnt>1138
</span><span class=lnt>1139
</span><span class=lnt>1140
</span><span class=lnt>1141
</span><span class=lnt>1142
</span><span class=lnt>1143
</span><span class=lnt>1144
</span><span class=lnt>1145
</span><span class=lnt>1146
</span><span class=lnt>1147
</span><span class=lnt>1148
</span><span class=lnt>1149
</span><span class=lnt>1150
</span><span class=lnt>1151
</span><span class=lnt>1152
</span><span class=lnt>1153
</span><span class=lnt>1154
</span><span class=lnt>1155
</span><span class=lnt>1156
</span><span class=lnt>1157
</span><span class=lnt>1158
</span><span class=lnt>1159
</span><span class=lnt>1160
</span><span class=lnt>1161
</span><span class=lnt>1162
</span><span class=lnt>1163
</span><span class=lnt>1164
</span><span class=lnt>1165
</span><span class=lnt>1166
</span><span class=lnt>1167
</span><span class=lnt>1168
</span><span class=lnt>1169
</span><span class=lnt>1170
</span><span class=lnt>1171
</span><span class=lnt>1172
</span><span class=lnt>1173
</span><span class=lnt>1174
</span><span class=lnt>1175
</span><span class=lnt>1176
</span><span class=lnt>1177
</span><span class=lnt>1178
</span><span class=lnt>1179
</span><span class=lnt>1180
</span><span class=lnt>1181
</span><span class=lnt>1182
</span><span class=lnt>1183
</span><span class=lnt>1184
</span><span class=lnt>1185
</span><span class=lnt>1186
</span><span class=lnt>1187
</span><span class=lnt>1188
</span><span class=lnt>1189
</span><span class=lnt>1190
</span><span class=lnt>1191
</span><span class=lnt>1192
</span><span class=lnt>1193
</span><span class=lnt>1194
</span><span class=lnt>1195
</span><span class=lnt>1196
</span><span class=lnt>1197
</span><span class=lnt>1198
</span><span class=lnt>1199
</span><span class=lnt>1200
</span><span class=lnt>1201
</span><span class=lnt>1202
</span><span class=lnt>1203
</span><span class=lnt>1204
</span><span class=lnt>1205
</span><span class=lnt>1206
</span><span class=lnt>1207
</span><span class=lnt>1208
</span><span class=lnt>1209
</span><span class=lnt>1210
</span><span class=lnt>1211
</span><span class=lnt>1212
</span><span class=lnt>1213
</span><span class=lnt>1214
</span><span class=lnt>1215
</span><span class=lnt>1216
</span><span class=lnt>1217
</span><span class=lnt>1218
</span><span class=lnt>1219
</span><span class=lnt>1220
</span><span class=lnt>1221
</span><span class=lnt>1222
</span><span class=lnt>1223
</span><span class=lnt>1224
</span><span class=lnt>1225
</span><span class=lnt>1226
</span><span class=lnt>1227
</span><span class=lnt>1228
</span><span class=lnt>1229
</span><span class=lnt>1230
</span><span class=lnt>1231
</span><span class=lnt>1232
</span><span class=lnt>1233
</span><span class=lnt>1234
</span><span class=lnt>1235
</span><span class=lnt>1236
</span><span class=lnt>1237
</span><span class=lnt>1238
</span><span class=lnt>1239
</span><span class=lnt>1240
</span><span class=lnt>1241
</span><span class=lnt>1242
</span><span class=lnt>1243
</span><span class=lnt>1244
</span><span class=lnt>1245
</span><span class=lnt>1246
</span><span class=lnt>1247
</span><span class=lnt>1248
</span><span class=lnt>1249
</span><span class=lnt>1250
</span><span class=lnt>1251
</span><span class=lnt>1252
</span><span class=lnt>1253
</span><span class=lnt>1254
</span><span class=lnt>1255
</span><span class=lnt>1256
</span><span class=lnt>1257
</span><span class=lnt>1258
</span><span class=lnt>1259
</span><span class=lnt>1260
</span><span class=lnt>1261
</span><span class=lnt>1262
</span><span class=lnt>1263
</span><span class=lnt>1264
</span><span class=lnt>1265
</span><span class=lnt>1266
</span><span class=lnt>1267
</span><span class=lnt>1268
</span><span class=lnt>1269
</span><span class=lnt>1270
</span><span class=lnt>1271
</span><span class=lnt>1272
</span><span class=lnt>1273
</span><span class=lnt>1274
</span><span class=lnt>1275
</span><span class=lnt>1276
</span><span class=lnt>1277
</span><span class=lnt>1278
</span><span class=lnt>1279
</span><span class=lnt>1280
</span><span class=lnt>1281
</span><span class=lnt>1282
</span><span class=lnt>1283
</span><span class=lnt>1284
</span><span class=lnt>1285
</span><span class=lnt>1286
</span><span class=lnt>1287
</span><span class=lnt>1288
</span><span class=lnt>1289
</span><span class=lnt>1290
</span><span class=lnt>1291
</span><span class=lnt>1292
</span><span class=lnt>1293
</span><span class=lnt>1294
</span><span class=lnt>1295
</span><span class=lnt>1296
</span><span class=lnt>1297
</span><span class=lnt>1298
</span><span class=lnt>1299
</span><span class=lnt>1300
</span><span class=lnt>1301
</span><span class=lnt>1302
</span><span class=lnt>1303
</span><span class=lnt>1304
</span><span class=lnt>1305
</span><span class=lnt>1306
</span><span class=lnt>1307
</span><span class=lnt>1308
</span><span class=lnt>1309
</span><span class=lnt>1310
</span><span class=lnt>1311
</span><span class=lnt>1312
</span><span class=lnt>1313
</span><span class=lnt>1314
</span><span class=lnt>1315
</span><span class=lnt>1316
</span><span class=lnt>1317
</span><span class=lnt>1318
</span><span class=lnt>1319
</span><span class=lnt>1320
</span><span class=lnt>1321
</span><span class=lnt>1322
</span><span class=lnt>1323
</span><span class=lnt>1324
</span><span class=lnt>1325
</span><span class=lnt>1326
</span><span class=lnt>1327
</span><span class=lnt>1328
</span><span class=lnt>1329
</span><span class=lnt>1330
</span><span class=lnt>1331
</span><span class=lnt>1332
</span><span class=lnt>1333
</span><span class=lnt>1334
</span><span class=lnt>1335
</span><span class=lnt>1336
</span><span class=lnt>1337
</span><span class=lnt>1338
</span><span class=lnt>1339
</span><span class=lnt>1340
</span><span class=lnt>1341
</span><span class=lnt>1342
</span><span class=lnt>1343
</span></code></pre></td><td class=lntd><pre tabindex=0 class=chroma><code class=language-python data-lang=python><span class=line><span class=cl><span class=ch>#!/usr/bin/env python3</span>
</span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>Generador de Tarjetas de √Ålbumes
</span></span></span><span class=line><span class=cl><span class=s2>Crea dos im√°genes verticales de 52x82mm para tarjetas de √°lbumes musicales.
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>Cara A: Portada del disco + informaci√≥n del √°lbum
</span></span></span><span class=line><span class=cl><span class=s2>Cara B: Lista de pistas
</span></span></span><span class=line><span class=cl><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>Requisitos:
</span></span></span><span class=line><span class=cl><span class=s2>- mutagen: para leer tags de archivos de m√∫sica
</span></span></span><span class=line><span class=cl><span class=s2>- Pillow: para generar im√°genes
</span></span></span><span class=line><span class=cl><span class=s2>- musicbrainzngs: para buscar informaci√≥n en MusicBrainz
</span></span></span><span class=line><span class=cl><span class=s2>- requests: para descargar portadas
</span></span></span><span class=line><span class=cl><span class=s2>&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>os</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>sys</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>json</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>argparse</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>pathlib</span> <span class=kn>import</span> <span class=n>Path</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>typing</span> <span class=kn>import</span> <span class=n>Dict</span><span class=p>,</span> <span class=n>List</span><span class=p>,</span> <span class=n>Optional</span><span class=p>,</span> <span class=n>Tuple</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>logging</span>
</span></span><span class=line><span class=cl><span class=kn>import</span> <span class=nn>colorsys</span>
</span></span><span class=line><span class=cl><span class=kn>from</span> <span class=nn>collections</span> <span class=kn>import</span> <span class=n>Counter</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>mutagen</span> <span class=kn>import</span> <span class=n>File</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>mutagen.id3</span> <span class=kn>import</span> <span class=n>ID3NoHeaderError</span>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Error: mutagen no est√° instalado. Instala con: pip install mutagen&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>PIL</span> <span class=kn>import</span> <span class=n>Image</span><span class=p>,</span> <span class=n>ImageDraw</span><span class=p>,</span> <span class=n>ImageFont</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>PIL.ImageColor</span> <span class=kn>import</span> <span class=n>getrgb</span>
</span></span><span class=line><span class=cl>    <span class=kn>import</span> <span class=nn>PIL.ImageStat</span> <span class=k>as</span> <span class=nn>ImageStat</span>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Error: Pillow no est√° instalado. Instala con: pip install Pillow&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=kn>import</span> <span class=nn>musicbrainzngs</span>
</span></span><span class=line><span class=cl>    <span class=c1># Silenciar los warnings innecesarios de musicbrainzngs</span>
</span></span><span class=line><span class=cl>    <span class=n>musicbrainzngs</span><span class=o>.</span><span class=n>set_useragent</span><span class=p>(</span><span class=s2>&#34;AlbumCardGenerator&#34;</span><span class=p>,</span> <span class=s2>&#34;1.0&#34;</span><span class=p>,</span> <span class=s2>&#34;https://github.com/example/album-card-generator&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=c1># Configurar logging de musicbrainzngs para que no muestre warnings menores</span>
</span></span><span class=line><span class=cl>    <span class=n>musicbrainz_logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=s1>&#39;musicbrainzngs.musicbrainz&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>musicbrainz_logger</span><span class=o>.</span><span class=n>setLevel</span><span class=p>(</span><span class=n>logging</span><span class=o>.</span><span class=n>WARNING</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Error: musicbrainzngs no est√° instalado. Instala con: pip install musicbrainzngs&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=kn>import</span> <span class=nn>requests</span>
</span></span><span class=line><span class=cl>    <span class=c1># Silenciar warnings de requests</span>
</span></span><span class=line><span class=cl>    <span class=n>requests</span><span class=o>.</span><span class=n>packages</span><span class=o>.</span><span class=n>urllib3</span><span class=o>.</span><span class=n>disable_warnings</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    <span class=n>requests_logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=s1>&#39;urllib3&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>requests_logger</span><span class=o>.</span><span class=n>setLevel</span><span class=p>(</span><span class=n>logging</span><span class=o>.</span><span class=n>WARNING</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Error: requests no est√° instalado. Instala con: pip install requests&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=kn>import</span> <span class=nn>qrcode</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>qrcode.image.styledpil</span> <span class=kn>import</span> <span class=n>StyledPilImage</span>
</span></span><span class=line><span class=cl>    <span class=kn>from</span> <span class=nn>qrcode.image.styles.moduledrawers</span> <span class=kn>import</span> <span class=n>RoundedModuleDrawer</span>
</span></span><span class=line><span class=cl><span class=k>except</span> <span class=ne>ImportError</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=nb>print</span><span class=p>(</span><span class=s2>&#34;Error: qrcode no est√° instalado. Instala con: pip install qrcode[pil]&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Configuraci√≥n de logging</span>
</span></span><span class=line><span class=cl><span class=n>logging</span><span class=o>.</span><span class=n>basicConfig</span><span class=p>(</span><span class=n>level</span><span class=o>=</span><span class=n>logging</span><span class=o>.</span><span class=n>INFO</span><span class=p>,</span> <span class=nb>format</span><span class=o>=</span><span class=s1>&#39;</span><span class=si>%(asctime)s</span><span class=s1> - </span><span class=si>%(levelname)s</span><span class=s1> - </span><span class=si>%(message)s</span><span class=s1>&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>logger</span> <span class=o>=</span> <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>(</span><span class=vm>__name__</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Constantes de dise√±o (en p√≠xeles a 300 DPI)</span>
</span></span><span class=line><span class=cl><span class=n>DPI</span> <span class=o>=</span> <span class=mi>300</span>
</span></span><span class=line><span class=cl><span class=n>CARD_WIDTH_MM</span> <span class=o>=</span> <span class=mi>52</span>
</span></span><span class=line><span class=cl><span class=n>CARD_HEIGHT_MM</span> <span class=o>=</span> <span class=mi>82</span>
</span></span><span class=line><span class=cl><span class=n>COVER_SIZE_MM</span> <span class=o>=</span> <span class=mi>51</span>
</span></span><span class=line><span class=cl><span class=n>TEXT_AREA_HEIGHT_MM</span> <span class=o>=</span> <span class=mi>30</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Conversi√≥n de mm a p√≠xeles</span>
</span></span><span class=line><span class=cl><span class=n>CARD_WIDTH</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>CARD_WIDTH_MM</span> <span class=o>*</span> <span class=n>DPI</span> <span class=o>/</span> <span class=mf>25.4</span><span class=p>)</span>  <span class=c1># ~613 px</span>
</span></span><span class=line><span class=cl><span class=n>CARD_HEIGHT</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>CARD_HEIGHT_MM</span> <span class=o>*</span> <span class=n>DPI</span> <span class=o>/</span> <span class=mf>25.4</span><span class=p>)</span>  <span class=c1># ~969 px</span>
</span></span><span class=line><span class=cl><span class=n>COVER_SIZE</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>COVER_SIZE_MM</span> <span class=o>*</span> <span class=n>DPI</span> <span class=o>/</span> <span class=mf>25.4</span><span class=p>)</span>  <span class=c1># ~601 px</span>
</span></span><span class=line><span class=cl><span class=n>TEXT_AREA_HEIGHT</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>TEXT_AREA_HEIGHT_MM</span> <span class=o>*</span> <span class=n>DPI</span> <span class=o>/</span> <span class=mf>25.4</span><span class=p>)</span>  <span class=c1># ~354 px</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=c1># Colores</span>
</span></span><span class=line><span class=cl><span class=n>WHITE</span> <span class=o>=</span> <span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>BLACK</span> <span class=o>=</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>GRAY_LIGHT</span> <span class=o>=</span> <span class=p>(</span><span class=mi>230</span><span class=p>,</span> <span class=mi>230</span><span class=p>,</span> <span class=mi>230</span><span class=p>)</span>
</span></span><span class=line><span class=cl><span class=n>GRAY_DARK</span> <span class=o>=</span> <span class=p>(</span><span class=mi>80</span><span class=p>,</span> <span class=mi>80</span><span class=p>,</span> <span class=mi>80</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>ColorAnalyzer</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Analizador de colores para extraer paletas de im√°genes&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>extract_dominant_color</span><span class=p>(</span><span class=n>image</span><span class=p>:</span> <span class=n>Image</span><span class=o>.</span><span class=n>Image</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Extrae el color dominante de una imagen&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Redimensionar para an√°lisis m√°s r√°pido</span>
</span></span><span class=line><span class=cl>            <span class=n>img</span> <span class=o>=</span> <span class=n>image</span><span class=o>.</span><span class=n>copy</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>img</span> <span class=o>=</span> <span class=n>img</span><span class=o>.</span><span class=n>resize</span><span class=p>((</span><span class=mi>150</span><span class=p>,</span> <span class=mi>150</span><span class=p>),</span> <span class=n>Image</span><span class=o>.</span><span class=n>Resampling</span><span class=o>.</span><span class=n>LANCZOS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>img</span> <span class=o>=</span> <span class=n>img</span><span class=o>.</span><span class=n>convert</span><span class=p>(</span><span class=s1>&#39;RGB&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># M√©todo 1: Color m√°s com√∫n</span>
</span></span><span class=line><span class=cl>            <span class=n>pixels</span> <span class=o>=</span> <span class=nb>list</span><span class=p>(</span><span class=n>img</span><span class=o>.</span><span class=n>getdata</span><span class=p>())</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Agrupar colores similares (reducir ruido)</span>
</span></span><span class=line><span class=cl>            <span class=n>grouped_colors</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span> <span class=ow>in</span> <span class=n>pixels</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># Reducir precisi√≥n para agrupar colores similares</span>
</span></span><span class=line><span class=cl>                <span class=n>r</span> <span class=o>=</span> <span class=p>(</span><span class=n>r</span> <span class=o>//</span> <span class=mi>10</span><span class=p>)</span> <span class=o>*</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>                <span class=n>g</span> <span class=o>=</span> <span class=p>(</span><span class=n>g</span> <span class=o>//</span> <span class=mi>10</span><span class=p>)</span> <span class=o>*</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>                <span class=n>b</span> <span class=o>=</span> <span class=p>(</span><span class=n>b</span> <span class=o>//</span> <span class=mi>10</span><span class=p>)</span> <span class=o>*</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>                <span class=n>grouped_colors</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Contar frecuencias</span>
</span></span><span class=line><span class=cl>            <span class=n>color_counter</span> <span class=o>=</span> <span class=n>Counter</span><span class=p>(</span><span class=n>grouped_colors</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Filtrar colores muy oscuros o muy claros (probablemente bordes)</span>
</span></span><span class=line><span class=cl>            <span class=n>filtered_colors</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>color</span><span class=p>,</span> <span class=n>count</span> <span class=ow>in</span> <span class=n>color_counter</span><span class=o>.</span><span class=n>most_common</span><span class=p>(</span><span class=mi>20</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=n>color</span>
</span></span><span class=line><span class=cl>                <span class=n>brightness</span> <span class=o>=</span> <span class=p>(</span><span class=n>r</span> <span class=o>+</span> <span class=n>g</span> <span class=o>+</span> <span class=n>b</span><span class=p>)</span> <span class=o>/</span> <span class=mi>3</span>
</span></span><span class=line><span class=cl>                <span class=c1># Evitar negro puro, blanco puro y grises muy extremos</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=mi>20</span> <span class=o>&lt;</span> <span class=n>brightness</span> <span class=o>&lt;</span> <span class=mi>235</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=c1># Evitar colores muy desaturados (grises)</span>
</span></span><span class=line><span class=cl>                    <span class=n>max_val</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>min_val</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>saturation</span> <span class=o>=</span> <span class=p>(</span><span class=n>max_val</span> <span class=o>-</span> <span class=n>min_val</span><span class=p>)</span> <span class=o>/</span> <span class=n>max_val</span> <span class=k>if</span> <span class=n>max_val</span> <span class=o>&gt;</span> <span class=mi>0</span> <span class=k>else</span> <span class=mi>0</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>saturation</span> <span class=o>&gt;</span> <span class=mf>0.1</span> <span class=ow>or</span> <span class=n>brightness</span> <span class=o>&lt;</span> <span class=mi>100</span><span class=p>:</span>  <span class=c1># Permitir colores oscuros aunque sean desaturados</span>
</span></span><span class=line><span class=cl>                        <span class=n>filtered_colors</span><span class=o>.</span><span class=n>append</span><span class=p>((</span><span class=n>color</span><span class=p>,</span> <span class=n>count</span><span class=p>))</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>filtered_colors</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>dominant_color</span> <span class=o>=</span> <span class=n>filtered_colors</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># Fallback: usar estad√≠sticas de imagen</span>
</span></span><span class=line><span class=cl>                <span class=n>stat</span> <span class=o>=</span> <span class=n>ImageStat</span><span class=o>.</span><span class=n>Stat</span><span class=p>(</span><span class=n>img</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>dominant_color</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>stat</span><span class=o>.</span><span class=n>mean</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>dominant_color</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error extrayendo color dominante: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>(</span><span class=mi>80</span><span class=p>,</span> <span class=mi>80</span><span class=p>,</span> <span class=mi>80</span><span class=p>)</span>  <span class=c1># Gris oscuro como fallback</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_contrast_color</span><span class=p>(</span><span class=n>bg_color</span><span class=p>:</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Obtiene un color de texto que contraste bien con el fondo&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=n>bg_color</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Calcular luminancia (brillo percibido)</span>
</span></span><span class=line><span class=cl>        <span class=n>luminance</span> <span class=o>=</span> <span class=p>(</span><span class=mf>0.299</span> <span class=o>*</span> <span class=n>r</span> <span class=o>+</span> <span class=mf>0.587</span> <span class=o>*</span> <span class=n>g</span> <span class=o>+</span> <span class=mf>0.114</span> <span class=o>*</span> <span class=n>b</span><span class=p>)</span> <span class=o>/</span> <span class=mi>255</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>luminance</span> <span class=o>&gt;</span> <span class=mf>0.5</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Fondo claro -&gt; texto oscuro</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>(</span><span class=mi>40</span><span class=p>,</span> <span class=mi>40</span><span class=p>,</span> <span class=mi>40</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Fondo oscuro -&gt; texto claro</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>(</span><span class=mi>240</span><span class=p>,</span> <span class=mi>240</span><span class=p>,</span> <span class=mi>240</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_secondary_color</span><span class=p>(</span><span class=n>bg_color</span><span class=p>:</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Obtiene un color secundario para texto menos importante&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>primary</span> <span class=o>=</span> <span class=n>ColorAnalyzer</span><span class=o>.</span><span class=n>get_contrast_color</span><span class=p>(</span><span class=n>bg_color</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=n>primary</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Hacer el color secundario un poco m√°s sutil</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>sum</span><span class=p>(</span><span class=n>primary</span><span class=p>)</span> <span class=o>&gt;</span> <span class=mi>400</span><span class=p>:</span>  <span class=c1># Color claro</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>(</span><span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>r</span> <span class=o>-</span> <span class=mi>60</span><span class=p>),</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>g</span> <span class=o>-</span> <span class=mi>60</span><span class=p>),</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=n>b</span> <span class=o>-</span> <span class=mi>60</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>  <span class=c1># Color oscuro</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=p>(</span><span class=nb>min</span><span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=n>r</span> <span class=o>+</span> <span class=mi>60</span><span class=p>),</span> <span class=nb>min</span><span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=n>g</span> <span class=o>+</span> <span class=mi>60</span><span class=p>),</span> <span class=nb>min</span><span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=n>b</span> <span class=o>+</span> <span class=mi>60</span><span class=p>))</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_border_color</span><span class=p>(</span><span class=n>bg_color</span><span class=p>:</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Obtiene un color sutil para bordes&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=n>bg_color</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Calcular luminancia</span>
</span></span><span class=line><span class=cl>        <span class=n>luminance</span> <span class=o>=</span> <span class=p>(</span><span class=mf>0.299</span> <span class=o>*</span> <span class=n>r</span> <span class=o>+</span> <span class=mf>0.587</span> <span class=o>*</span> <span class=n>g</span> <span class=o>+</span> <span class=mf>0.114</span> <span class=o>*</span> <span class=n>b</span><span class=p>)</span> <span class=o>/</span> <span class=mi>255</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>luminance</span> <span class=o>&gt;</span> <span class=mf>0.5</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Fondo claro -&gt; borde m√°s oscuro</span>
</span></span><span class=line><span class=cl>            <span class=n>factor</span> <span class=o>=</span> <span class=mf>0.8</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Fondo oscuro -&gt; borde m√°s claro</span>
</span></span><span class=line><span class=cl>            <span class=n>factor</span> <span class=o>=</span> <span class=mf>1.2</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>new_r</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>int</span><span class=p>(</span><span class=n>r</span> <span class=o>*</span> <span class=n>factor</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=n>new_g</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>int</span><span class=p>(</span><span class=n>g</span> <span class=o>*</span> <span class=n>factor</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        <span class=n>new_b</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>int</span><span class=p>(</span><span class=n>b</span> <span class=o>*</span> <span class=n>factor</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>(</span><span class=n>new_r</span><span class=p>,</span> <span class=n>new_g</span><span class=p>,</span> <span class=n>new_b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>enhance_color</span><span class=p>(</span><span class=n>color</span><span class=p>:</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>],</span> <span class=n>saturation_boost</span><span class=p>:</span> <span class=nb>float</span> <span class=o>=</span> <span class=mf>1.2</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Realza un color aumentando su saturaci√≥n&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=p>[</span><span class=n>c</span> <span class=o>/</span> <span class=mf>255.0</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>color</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Convertir a HSV</span>
</span></span><span class=line><span class=cl>        <span class=n>h</span><span class=p>,</span> <span class=n>s</span><span class=p>,</span> <span class=n>v</span> <span class=o>=</span> <span class=n>colorsys</span><span class=o>.</span><span class=n>rgb_to_hsv</span><span class=p>(</span><span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Aumentar saturaci√≥n</span>
</span></span><span class=line><span class=cl>        <span class=n>s</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=mf>1.0</span><span class=p>,</span> <span class=n>s</span> <span class=o>*</span> <span class=n>saturation_boost</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Convertir de vuelta a RGB</span>
</span></span><span class=line><span class=cl>        <span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=n>colorsys</span><span class=o>.</span><span class=n>hsv_to_rgb</span><span class=p>(</span><span class=n>h</span><span class=p>,</span> <span class=n>s</span><span class=p>,</span> <span class=n>v</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=p>(</span><span class=nb>int</span><span class=p>(</span><span class=n>r</span> <span class=o>*</span> <span class=mi>255</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>g</span> <span class=o>*</span> <span class=mi>255</span><span class=p>),</span> <span class=nb>int</span><span class=p>(</span><span class=n>b</span> <span class=o>*</span> <span class=mi>255</span><span class=p>))</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>AlbumInfo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Clase para almacenar informaci√≥n del √°lbum&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>artist</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>album</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>date</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>label</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>genres</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>tracks</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>mbid</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>artist_mbid</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>  <span class=c1># Nuevo campo para MBID del artista</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>cover_art_url</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>cover_image</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>color_palette</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;background&#39;</span><span class=p>:</span> <span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;text_primary&#39;</span><span class=p>:</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;text_secondary&#39;</span><span class=p>:</span> <span class=p>(</span><span class=mi>80</span><span class=p>,</span> <span class=mi>80</span><span class=p>,</span> <span class=mi>80</span><span class=p>),</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;border&#39;</span><span class=p>:</span> <span class=p>(</span><span class=mi>230</span><span class=p>,</span> <span class=mi>230</span><span class=p>,</span> <span class=mi>230</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>qr_links</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;wikipedia_artist&#39;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s1>&#39;genius_album&#39;</span><span class=p>:</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>QRLinkGenerator</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Generador de enlaces para c√≥digos QR&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_wikipedia_from_musicbrainz</span><span class=p>(</span><span class=n>artist_mbid</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Obtiene el enlace de Wikipedia desde Wikidata a trav√©s de MusicBrainz&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Buscando Wikipedia en MusicBrainz para MBID: </span><span class=si>{</span><span class=n>artist_mbid</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Obtener informaci√≥n del artista desde MusicBrainz incluyendo Wikidata</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=n>musicbrainzngs</span><span class=o>.</span><span class=n>get_artist_by_id</span><span class=p>(</span><span class=n>artist_mbid</span><span class=p>,</span> <span class=n>includes</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;url-rels&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=s1>&#39;artist&#39;</span> <span class=ow>not</span> <span class=ow>in</span> <span class=n>result</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>            <span class=n>artist</span> <span class=o>=</span> <span class=n>result</span><span class=p>[</span><span class=s1>&#39;artist&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Buscar relaciones de URL, especialmente Wikidata</span>
</span></span><span class=line><span class=cl>            <span class=n>wikidata_url</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>            <span class=n>wikipedia_urls</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=s1>&#39;url-relation-list&#39;</span> <span class=ow>in</span> <span class=n>artist</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>url_rel</span> <span class=ow>in</span> <span class=n>artist</span><span class=p>[</span><span class=s1>&#39;url-relation-list&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                    <span class=n>url</span> <span class=o>=</span> <span class=n>url_rel</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;target&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>rel_type</span> <span class=o>=</span> <span class=n>url_rel</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;type&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># Enlace directo a Wikipedia</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=s1>&#39;wikipedia.org&#39;</span> <span class=ow>in</span> <span class=n>url</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=s1>&#39;/es.wikipedia.org/&#39;</span> <span class=ow>in</span> <span class=n>url</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                            <span class=n>wikipedia_urls</span><span class=p>[</span><span class=s1>&#39;es&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>url</span>
</span></span><span class=line><span class=cl>                        <span class=k>elif</span> <span class=s1>&#39;/en.wikipedia.org/&#39;</span> <span class=ow>in</span> <span class=n>url</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                            <span class=n>wikipedia_urls</span><span class=p>[</span><span class=s1>&#39;en&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>url</span>
</span></span><span class=line><span class=cl>                        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                            <span class=c1># Otros idiomas</span>
</span></span><span class=line><span class=cl>                            <span class=n>lang</span> <span class=o>=</span> <span class=n>url</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;.&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;//&#39;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                            <span class=n>wikipedia_urls</span><span class=p>[</span><span class=n>lang</span><span class=p>]</span> <span class=o>=</span> <span class=n>url</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=c1># Enlace de Wikidata</span>
</span></span><span class=line><span class=cl>                    <span class=k>elif</span> <span class=s1>&#39;wikidata.org&#39;</span> <span class=ow>in</span> <span class=n>url</span> <span class=ow>and</span> <span class=n>rel_type</span> <span class=o>==</span> <span class=s1>&#39;wikidata&#39;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>wikidata_url</span> <span class=o>=</span> <span class=n>url</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Preferir enlaces directos de Wikipedia (espa√±ol &gt; ingl√©s &gt; otros)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=s1>&#39;es&#39;</span> <span class=ow>in</span> <span class=n>wikipedia_urls</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Encontrada Wikipedia directa en espa√±ol: </span><span class=si>{</span><span class=n>wikipedia_urls</span><span class=p>[</span><span class=s1>&#39;es&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>wikipedia_urls</span><span class=p>[</span><span class=s1>&#39;es&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=s1>&#39;en&#39;</span> <span class=ow>in</span> <span class=n>wikipedia_urls</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Encontrada Wikipedia directa en ingl√©s: </span><span class=si>{</span><span class=n>wikipedia_urls</span><span class=p>[</span><span class=s1>&#39;en&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>wikipedia_urls</span><span class=p>[</span><span class=s1>&#39;en&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>wikipedia_urls</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=c1># Tomar el primer idioma disponible</span>
</span></span><span class=line><span class=cl>                <span class=n>first_lang</span> <span class=o>=</span> <span class=nb>next</span><span class=p>(</span><span class=nb>iter</span><span class=p>(</span><span class=n>wikipedia_urls</span><span class=p>))</span>
</span></span><span class=line><span class=cl>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Encontrada Wikipedia en </span><span class=si>{</span><span class=n>first_lang</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>wikipedia_urls</span><span class=p>[</span><span class=n>first_lang</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>wikipedia_urls</span><span class=p>[</span><span class=n>first_lang</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Si no hay enlaces directos pero hay Wikidata, intentar obtener Wikipedia desde ah√≠</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>wikidata_url</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>wiki_from_wikidata</span> <span class=o>=</span> <span class=n>QRLinkGenerator</span><span class=o>.</span><span class=n>_get_wikipedia_from_wikidata</span><span class=p>(</span><span class=n>wikidata_url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>wiki_from_wikidata</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=n>wiki_from_wikidata</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error obteniendo Wikipedia desde MusicBrainz: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_get_wikipedia_from_wikidata</span><span class=p>(</span><span class=n>wikidata_url</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Obtiene enlaces de Wikipedia desde Wikidata&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Extraer Q-ID de Wikidata</span>
</span></span><span class=line><span class=cl>            <span class=n>qid</span> <span class=o>=</span> <span class=n>wikidata_url</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)[</span><span class=o>-</span><span class=mi>1</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=ow>not</span> <span class=n>qid</span><span class=o>.</span><span class=n>startswith</span><span class=p>(</span><span class=s1>&#39;Q&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Consultando Wikidata para </span><span class=si>{</span><span class=n>qid</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Consulta SPARQL a Wikidata para obtener enlaces de Wikipedia</span>
</span></span><span class=line><span class=cl>            <span class=n>sparql_query</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;&#34;&#34;
</span></span></span><span class=line><span class=cl><span class=s2>            SELECT ?article ?lang WHERE </span><span class=se>{{</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>              ?article schema:about wd:</span><span class=si>{</span><span class=n>qid</span><span class=si>}</span><span class=s2> ;
</span></span></span><span class=line><span class=cl><span class=s2>                       schema:inLanguage ?lang ;
</span></span></span><span class=line><span class=cl><span class=s2>                       schema:isPartOf ?wiki .
</span></span></span><span class=line><span class=cl><span class=s2>              ?wiki wikibase:wikiGroup &#34;wikipedia&#34; .
</span></span></span><span class=line><span class=cl><span class=s2>              FILTER(?lang IN (&#34;es&#34;, &#34;en&#34;))
</span></span></span><span class=line><span class=cl><span class=s2>            </span><span class=se>}}</span><span class=s2>
</span></span></span><span class=line><span class=cl><span class=s2>            ORDER BY DESC(?lang = &#34;es&#34;)
</span></span></span><span class=line><span class=cl><span class=s2>            LIMIT 2
</span></span></span><span class=line><span class=cl><span class=s2>            &#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Hacer petici√≥n a Wikidata</span>
</span></span><span class=line><span class=cl>            <span class=n>sparql_endpoint</span> <span class=o>=</span> <span class=s2>&#34;https://query.wikidata.org/sparql&#34;</span>
</span></span><span class=line><span class=cl>            <span class=n>headers</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;User-Agent&#39;</span><span class=p>:</span> <span class=s1>&#39;AlbumCardGenerator/1.0&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;Accept&#39;</span><span class=p>:</span> <span class=s1>&#39;application/json&#39;</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>sparql_endpoint</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>params</span><span class=o>=</span><span class=p>{</span><span class=s1>&#39;query&#39;</span><span class=p>:</span> <span class=n>sparql_query</span><span class=p>,</span> <span class=s1>&#39;format&#39;</span><span class=p>:</span> <span class=s1>&#39;json&#39;</span><span class=p>},</span>
</span></span><span class=line><span class=cl>                <span class=n>headers</span><span class=o>=</span><span class=n>headers</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>timeout</span><span class=o>=</span><span class=mi>10</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>data</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=n>results</span> <span class=o>=</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;results&#39;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;bindings&#39;</span><span class=p>,</span> <span class=p>[])</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>result</span> <span class=ow>in</span> <span class=n>results</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>url</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;article&#39;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;value&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=n>lang</span> <span class=o>=</span> <span class=n>result</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;lang&#39;</span><span class=p>,</span> <span class=p>{})</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;value&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=n>url</span> <span class=ow>and</span> <span class=n>lang</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Encontrada Wikipedia desde Wikidata (</span><span class=si>{</span><span class=n>lang</span><span class=si>}</span><span class=s2>): </span><span class=si>{</span><span class=n>url</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                        <span class=k>return</span> <span class=n>url</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error consultando Wikidata: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>search_wikipedia_artist</span><span class=p>(</span><span class=n>artist_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>artist_mbid</span><span class=p>:</span> <span class=nb>str</span> <span class=o>=</span> <span class=kc>None</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Busca el enlace de Wikipedia del artista&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Buscando Wikipedia para: </span><span class=si>{</span><span class=n>artist_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Primero intentar con MusicBrainz/Wikidata si tenemos MBID</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>artist_mbid</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>mb_wikipedia</span> <span class=o>=</span> <span class=n>QRLinkGenerator</span><span class=o>.</span><span class=n>get_wikipedia_from_musicbrainz</span><span class=p>(</span><span class=n>artist_mbid</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>mb_wikipedia</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=n>mb_wikipedia</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># M√©todo de respaldo: b√∫squeda directa por nombre</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Intentando b√∫squeda directa por nombre del artista&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Limpiar nombre del artista para b√∫squeda</span>
</span></span><span class=line><span class=cl>            <span class=n>clean_artist</span> <span class=o>=</span> <span class=n>artist_name</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34; &#34;</span><span class=p>,</span> <span class=s2>&#34;_&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;&amp;&#34;</span><span class=p>,</span> <span class=s2>&#34;and&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># URL directa de Wikipedia en espa√±ol</span>
</span></span><span class=line><span class=cl>            <span class=n>wiki_url_es</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;https://es.wikipedia.org/wiki/</span><span class=si>{</span><span class=n>clean_artist</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Verificar si existe la p√°gina en espa√±ol</span>
</span></span><span class=line><span class=cl>            <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>head</span><span class=p>(</span><span class=n>wiki_url_es</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Encontrada Wikipedia en espa√±ol: </span><span class=si>{</span><span class=n>wiki_url_es</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>wiki_url_es</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Si no existe en espa√±ol, probar en ingl√©s</span>
</span></span><span class=line><span class=cl>            <span class=n>wiki_url_en</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;https://en.wikipedia.org/wiki/</span><span class=si>{</span><span class=n>clean_artist</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>head</span><span class=p>(</span><span class=n>wiki_url_en</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Encontrada Wikipedia en ingl√©s: </span><span class=si>{</span><span class=n>wiki_url_en</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>wiki_url_en</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Buscar usando la API de Wikipedia</span>
</span></span><span class=line><span class=cl>            <span class=n>search_url</span> <span class=o>=</span> <span class=s2>&#34;https://es.wikipedia.org/api/rest_v1/page/title&#34;</span>
</span></span><span class=line><span class=cl>            <span class=n>params</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;q&#39;</span><span class=p>:</span> <span class=n>artist_name</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;limit&#39;</span><span class=p>:</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>search_url</span><span class=p>,</span> <span class=n>params</span><span class=o>=</span><span class=n>params</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>5</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>data</span> <span class=o>=</span> <span class=n>response</span><span class=o>.</span><span class=n>json</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>data</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;pages&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                    <span class=n>page_title</span> <span class=o>=</span> <span class=n>data</span><span class=p>[</span><span class=s1>&#39;pages&#39;</span><span class=p>][</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;title&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                    <span class=n>wiki_url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;https://es.wikipedia.org/wiki/</span><span class=si>{</span><span class=n>page_title</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>,</span> <span class=s1>&#39;_&#39;</span><span class=p>)</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>                    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Encontrada Wikipedia por b√∫squeda: </span><span class=si>{</span><span class=n>wiki_url</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=n>wiki_url</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error buscando Wikipedia para </span><span class=si>{</span><span class=n>artist_name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>search_genius_album</span><span class=p>(</span><span class=n>artist_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>album_name</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Busca el enlace de Genius del √°lbum&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Buscando Genius para: </span><span class=si>{</span><span class=n>artist_name</span><span class=si>}</span><span class=s2> - </span><span class=si>{</span><span class=n>album_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Limpiar nombres para URL</span>
</span></span><span class=line><span class=cl>            <span class=n>clean_artist</span> <span class=o>=</span> <span class=n>artist_name</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34; &#34;</span><span class=p>,</span> <span class=s2>&#34;-&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;&amp;&#34;</span><span class=p>,</span> <span class=s2>&#34;and&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>clean_album</span> <span class=o>=</span> <span class=n>album_name</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34; &#34;</span><span class=p>,</span> <span class=s2>&#34;-&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34;&amp;&#34;</span><span class=p>,</span> <span class=s2>&#34;and&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Remover caracteres especiales</span>
</span></span><span class=line><span class=cl>            <span class=kn>import</span> <span class=nn>re</span>
</span></span><span class=line><span class=cl>            <span class=n>clean_artist</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;[^\w\-]&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>clean_artist</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>clean_album</span> <span class=o>=</span> <span class=n>re</span><span class=o>.</span><span class=n>sub</span><span class=p>(</span><span class=sa>r</span><span class=s1>&#39;[^\w\-]&#39;</span><span class=p>,</span> <span class=s1>&#39;&#39;</span><span class=p>,</span> <span class=n>clean_album</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># URL t√≠pica de Genius para √°lbumes</span>
</span></span><span class=line><span class=cl>            <span class=n>genius_url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;https://genius.com/albums/</span><span class=si>{</span><span class=n>clean_artist</span><span class=si>}</span><span class=s2>/</span><span class=si>{</span><span class=n>clean_album</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Verificar si existe la p√°gina</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>head</span><span class=p>(</span><span class=n>genius_url</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span> <span class=n>allow_redirects</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Encontrado Genius: </span><span class=si>{</span><span class=n>genius_url</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=n>genius_url</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>pass</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Formato alternativo</span>
</span></span><span class=line><span class=cl>            <span class=n>genius_url_alt</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;https://genius.com/</span><span class=si>{</span><span class=n>clean_artist</span><span class=si>}</span><span class=s2>-</span><span class=si>{</span><span class=n>clean_album</span><span class=si>}</span><span class=s2>-album&#34;</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>head</span><span class=p>(</span><span class=n>genius_url_alt</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>5</span><span class=p>,</span> <span class=n>allow_redirects</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>response</span><span class=o>.</span><span class=n>status_code</span> <span class=o>==</span> <span class=mi>200</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Encontrado Genius (formato alternativo): </span><span class=si>{</span><span class=n>genius_url_alt</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=n>genius_url_alt</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>pass</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Si no se encuentra, generar URL de b√∫squeda</span>
</span></span><span class=line><span class=cl>            <span class=n>search_query</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>artist_name</span><span class=si>}</span><span class=s2> </span><span class=si>{</span><span class=n>album_name</span><span class=si>}</span><span class=s2>&#34;</span><span class=o>.</span><span class=n>replace</span><span class=p>(</span><span class=s2>&#34; &#34;</span><span class=p>,</span> <span class=s2>&#34;%20&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>search_url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;https://genius.com/search?q=</span><span class=si>{</span><span class=n>search_query</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Generando URL de b√∫squeda Genius: </span><span class=si>{</span><span class=n>search_url</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>search_url</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error buscando Genius para </span><span class=si>{</span><span class=n>artist_name</span><span class=si>}</span><span class=s2> - </span><span class=si>{</span><span class=n>album_name</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_qr_links</span><span class=p>(</span><span class=n>album_info</span><span class=p>:</span> <span class=n>AlbumInfo</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Genera los enlaces para los c√≥digos QR&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Buscar Wikipedia del artista (usando MBID si est√° disponible)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>album_info</span><span class=o>.</span><span class=n>artist</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>wikipedia_link</span> <span class=o>=</span> <span class=n>QRLinkGenerator</span><span class=o>.</span><span class=n>search_wikipedia_artist</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>album_info</span><span class=o>.</span><span class=n>artist</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                    <span class=n>album_info</span><span class=o>.</span><span class=n>artist_mbid</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>wikipedia_link</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>album_info</span><span class=o>.</span><span class=n>qr_links</span><span class=p>[</span><span class=s1>&#39;wikipedia_artist&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>wikipedia_link</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Buscar Genius del √°lbum</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>album_info</span><span class=o>.</span><span class=n>artist</span> <span class=ow>and</span> <span class=n>album_info</span><span class=o>.</span><span class=n>album</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>genius_link</span> <span class=o>=</span> <span class=n>QRLinkGenerator</span><span class=o>.</span><span class=n>search_genius_album</span><span class=p>(</span><span class=n>album_info</span><span class=o>.</span><span class=n>artist</span><span class=p>,</span> <span class=n>album_info</span><span class=o>.</span><span class=n>album</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>genius_link</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>album_info</span><span class=o>.</span><span class=n>qr_links</span><span class=p>[</span><span class=s1>&#39;genius_album&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>genius_link</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error generando enlaces QR: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>QRCodeGenerator</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Generador de c√≥digos QR&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>create_qr_code</span><span class=p>(</span><span class=n>url</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>size</span><span class=p>:</span> <span class=nb>int</span> <span class=o>=</span> <span class=mi>120</span><span class=p>,</span> <span class=n>bg_color</span><span class=p>:</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>),</span> 
</span></span><span class=line><span class=cl>                      <span class=n>fg_color</span><span class=p>:</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>]</span> <span class=o>=</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>))</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Image</span><span class=o>.</span><span class=n>Image</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Crea un c√≥digo QR con los colores especificados y m√°ximo contraste&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Optimizar colores para m√°ximo contraste</span>
</span></span><span class=line><span class=cl>            <span class=n>optimized_bg</span><span class=p>,</span> <span class=n>optimized_fg</span> <span class=o>=</span> <span class=n>QRCodeGenerator</span><span class=o>.</span><span class=n>_optimize_qr_colors</span><span class=p>(</span><span class=n>bg_color</span><span class=p>,</span> <span class=n>fg_color</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Configurar QR code</span>
</span></span><span class=line><span class=cl>            <span class=n>qr</span> <span class=o>=</span> <span class=n>qrcode</span><span class=o>.</span><span class=n>QRCode</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>version</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>error_correction</span><span class=o>=</span><span class=n>qrcode</span><span class=o>.</span><span class=n>constants</span><span class=o>.</span><span class=n>ERROR_CORRECT_M</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>box_size</span><span class=o>=</span><span class=mi>4</span><span class=p>,</span>  <span class=c1># Aumentado para mejor definici√≥n</span>
</span></span><span class=line><span class=cl>                <span class=n>border</span><span class=o>=</span><span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>qr</span><span class=o>.</span><span class=n>add_data</span><span class=p>(</span><span class=n>url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>qr</span><span class=o>.</span><span class=n>make</span><span class=p>(</span><span class=n>fit</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Crear imagen del QR</span>
</span></span><span class=line><span class=cl>            <span class=n>qr_img</span> <span class=o>=</span> <span class=n>qr</span><span class=o>.</span><span class=n>make_image</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>fill_color</span><span class=o>=</span><span class=n>optimized_fg</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>back_color</span><span class=o>=</span><span class=n>optimized_bg</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>image_factory</span><span class=o>=</span><span class=n>StyledPilImage</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>module_drawer</span><span class=o>=</span><span class=n>RoundedModuleDrawer</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Redimensionar al tama√±o deseado</span>
</span></span><span class=line><span class=cl>            <span class=n>qr_img</span> <span class=o>=</span> <span class=n>qr_img</span><span class=o>.</span><span class=n>resize</span><span class=p>((</span><span class=n>size</span><span class=p>,</span> <span class=n>size</span><span class=p>),</span> <span class=n>Image</span><span class=o>.</span><span class=n>Resampling</span><span class=o>.</span><span class=n>LANCZOS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>qr_img</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error creando c√≥digo QR para </span><span class=si>{</span><span class=n>url</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=nd>@staticmethod</span>
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_optimize_qr_colors</span><span class=p>(</span><span class=n>bg_color</span><span class=p>:</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>],</span> <span class=n>fg_color</span><span class=p>:</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>Tuple</span><span class=p>[</span><span class=n>Tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>],</span> <span class=n>Tuple</span><span class=p>[</span><span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>,</span> <span class=nb>int</span><span class=p>]]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Optimiza los colores del QR para m√°ximo contraste&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># Calcular luminancia del fondo</span>
</span></span><span class=line><span class=cl>        <span class=n>bg_luminance</span> <span class=o>=</span> <span class=p>(</span><span class=mf>0.299</span> <span class=o>*</span> <span class=n>bg_color</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span> <span class=o>+</span> <span class=mf>0.587</span> <span class=o>*</span> <span class=n>bg_color</span><span class=p>[</span><span class=mi>1</span><span class=p>]</span> <span class=o>+</span> <span class=mf>0.114</span> <span class=o>*</span> <span class=n>bg_color</span><span class=p>[</span><span class=mi>2</span><span class=p>])</span> <span class=o>/</span> <span class=mi>255</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Si el fondo es muy claro, asegurar QR oscuro</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>bg_luminance</span> <span class=o>&gt;</span> <span class=mf>0.6</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Fondo claro -&gt; QR muy oscuro para m√°ximo contraste</span>
</span></span><span class=line><span class=cl>            <span class=n>optimized_fg</span> <span class=o>=</span> <span class=p>(</span><span class=mi>20</span><span class=p>,</span> <span class=mi>20</span><span class=p>,</span> <span class=mi>20</span><span class=p>)</span>  <span class=c1># Casi negro</span>
</span></span><span class=line><span class=cl>            <span class=n>optimized_bg</span> <span class=o>=</span> <span class=n>bg_color</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=c1># Si el fondo es muy oscuro, asegurar QR claro  </span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>bg_luminance</span> <span class=o>&lt;</span> <span class=mf>0.4</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Fondo oscuro -&gt; QR muy claro para m√°ximo contraste</span>
</span></span><span class=line><span class=cl>            <span class=n>optimized_fg</span> <span class=o>=</span> <span class=p>(</span><span class=mi>240</span><span class=p>,</span> <span class=mi>240</span><span class=p>,</span> <span class=mi>240</span><span class=p>)</span>  <span class=c1># Casi blanco</span>
</span></span><span class=line><span class=cl>            <span class=n>optimized_bg</span> <span class=o>=</span> <span class=n>bg_color</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=c1># Para fondos intermedios, usar colores dados pero ajustados</span>
</span></span><span class=line><span class=cl>        <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Ajustar para garantizar contraste m√≠nimo</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>bg_luminance</span> <span class=o>&gt;</span> <span class=mf>0.5</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>optimized_fg</span> <span class=o>=</span> <span class=p>(</span><span class=mi>30</span><span class=p>,</span> <span class=mi>30</span><span class=p>,</span> <span class=mi>30</span><span class=p>)</span>  <span class=c1># Oscuro</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>optimized_fg</span> <span class=o>=</span> <span class=p>(</span><span class=mi>225</span><span class=p>,</span> <span class=mi>225</span><span class=p>,</span> <span class=mi>225</span><span class=p>)</span>  <span class=c1># Claro</span>
</span></span><span class=line><span class=cl>            <span class=n>optimized_bg</span> <span class=o>=</span> <span class=n>bg_color</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>optimized_bg</span><span class=p>,</span> <span class=n>optimized_fg</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MusicFileProcessor</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Procesador de archivos de m√∫sica&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>folder_path</span><span class=p>:</span> <span class=nb>str</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>folder_path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>folder_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>supported_formats</span> <span class=o>=</span> <span class=p>{</span><span class=s1>&#39;.mp3&#39;</span><span class=p>,</span> <span class=s1>&#39;.flac&#39;</span><span class=p>,</span> <span class=s1>&#39;.ogg&#39;</span><span class=p>,</span> <span class=s1>&#39;.mp4&#39;</span><span class=p>,</span> <span class=s1>&#39;.m4a&#39;</span><span class=p>,</span> <span class=s1>&#39;.wv&#39;</span><span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>get_audio_files</span><span class=p>(</span><span class=bp>self</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=n>Path</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Obtiene todos los archivos de audio de la carpeta&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>audio_files</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>file_path</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>folder_path</span><span class=o>.</span><span class=n>rglob</span><span class=p>(</span><span class=s1>&#39;*&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>file_path</span><span class=o>.</span><span class=n>suffix</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=ow>in</span> <span class=bp>self</span><span class=o>.</span><span class=n>supported_formats</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>audio_files</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Ordenar por nombre de archivo</span>
</span></span><span class=line><span class=cl>        <span class=n>audio_files</span><span class=o>.</span><span class=n>sort</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>audio_files</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>extract_album_info</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>audio_files</span><span class=p>:</span> <span class=n>List</span><span class=p>[</span><span class=n>Path</span><span class=p>])</span> <span class=o>-&gt;</span> <span class=n>AlbumInfo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Extrae informaci√≥n del √°lbum desde los archivos de audio&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>album_info</span> <span class=o>=</span> <span class=n>AlbumInfo</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>audio_files</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=s2>&#34;No se encontraron archivos de audio&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Procesar el primer archivo para obtener informaci√≥n general del √°lbum</span>
</span></span><span class=line><span class=cl>        <span class=n>first_file</span> <span class=o>=</span> <span class=n>audio_files</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>audio_file</span> <span class=o>=</span> <span class=n>File</span><span class=p>(</span><span class=n>first_file</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>audio_file</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>raise</span> <span class=ne>ValueError</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;No se pudo leer el archivo: </span><span class=si>{</span><span class=n>first_file</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Extraer informaci√≥n b√°sica</span>
</span></span><span class=line><span class=cl>            <span class=n>album_info</span><span class=o>.</span><span class=n>artist</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_tag</span><span class=p>(</span><span class=n>audio_file</span><span class=p>,</span> <span class=s1>&#39;artist&#39;</span><span class=p>,</span> <span class=s1>&#39;albumartist&#39;</span><span class=p>,</span> <span class=s1>&#39;TPE1&#39;</span><span class=p>,</span> <span class=s1>&#39;TPE2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>album_info</span><span class=o>.</span><span class=n>album</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_tag</span><span class=p>(</span><span class=n>audio_file</span><span class=p>,</span> <span class=s1>&#39;album&#39;</span><span class=p>,</span> <span class=s1>&#39;TALB&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>album_info</span><span class=o>.</span><span class=n>date</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_tag</span><span class=p>(</span><span class=n>audio_file</span><span class=p>,</span> <span class=s1>&#39;date&#39;</span><span class=p>,</span> <span class=s1>&#39;year&#39;</span><span class=p>,</span> <span class=s1>&#39;TDRC&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>album_info</span><span class=o>.</span><span class=n>label</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_tag</span><span class=p>(</span><span class=n>audio_file</span><span class=p>,</span> <span class=s1>&#39;label&#39;</span><span class=p>,</span> <span class=s1>&#39;publisher&#39;</span><span class=p>,</span> <span class=s1>&#39;TPUB&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># G√©neros</span>
</span></span><span class=line><span class=cl>            <span class=n>genre_tag</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_tag</span><span class=p>(</span><span class=n>audio_file</span><span class=p>,</span> <span class=s1>&#39;genre&#39;</span><span class=p>,</span> <span class=s1>&#39;TCON&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>genre_tag</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>album_info</span><span class=o>.</span><span class=n>genres</span> <span class=o>=</span> <span class=p>[</span><span class=n>g</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span> <span class=k>for</span> <span class=n>g</span> <span class=ow>in</span> <span class=n>genre_tag</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;,&#39;</span><span class=p>)]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># MBID</span>
</span></span><span class=line><span class=cl>            <span class=n>album_info</span><span class=o>.</span><span class=n>mbid</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_tag</span><span class=p>(</span><span class=n>audio_file</span><span class=p>,</span> <span class=s1>&#39;musicbrainz_albumid&#39;</span><span class=p>,</span> <span class=s1>&#39;TXXX:MusicBrainz Album Id&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># MBID del artista</span>
</span></span><span class=line><span class=cl>            <span class=n>album_info</span><span class=o>.</span><span class=n>artist_mbid</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_tag</span><span class=p>(</span><span class=n>audio_file</span><span class=p>,</span> <span class=s1>&#39;musicbrainz_artistid&#39;</span><span class=p>,</span> <span class=s1>&#39;TXXX:MusicBrainz Artist Id&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error procesando </span><span class=si>{</span><span class=n>first_file</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Procesar todas las pistas</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>file_path</span> <span class=ow>in</span> <span class=n>audio_files</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>audio_file</span> <span class=o>=</span> <span class=n>File</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>audio_file</span> <span class=ow>is</span> <span class=kc>None</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>continue</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>track_number</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_tag</span><span class=p>(</span><span class=n>audio_file</span><span class=p>,</span> <span class=s1>&#39;tracknumber&#39;</span><span class=p>,</span> <span class=s1>&#39;track&#39;</span><span class=p>,</span> <span class=s1>&#39;TRCK&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>title</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_tag</span><span class=p>(</span><span class=n>audio_file</span><span class=p>,</span> <span class=s1>&#39;title&#39;</span><span class=p>,</span> <span class=s1>&#39;TIT2&#39;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># Limpiar n√∫mero de pista (remover &#34;1/10&#34; -&gt; &#34;1&#34;)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>track_number</span> <span class=ow>and</span> <span class=s1>&#39;/&#39;</span> <span class=ow>in</span> <span class=n>track_number</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>track_number</span> <span class=o>=</span> <span class=n>track_number</span><span class=o>.</span><span class=n>split</span><span class=p>(</span><span class=s1>&#39;/&#39;</span><span class=p>)[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>track_info</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;number&#39;</span><span class=p>:</span> <span class=nb>int</span><span class=p>(</span><span class=n>track_number</span><span class=p>)</span> <span class=k>if</span> <span class=n>track_number</span> <span class=ow>and</span> <span class=n>track_number</span><span class=o>.</span><span class=n>isdigit</span><span class=p>()</span> <span class=k>else</span> <span class=nb>len</span><span class=p>(</span><span class=n>album_info</span><span class=o>.</span><span class=n>tracks</span><span class=p>)</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;title&#39;</span><span class=p>:</span> <span class=n>title</span> <span class=ow>or</span> <span class=n>file_path</span><span class=o>.</span><span class=n>stem</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                    <span class=s1>&#39;file&#39;</span><span class=p>:</span> <span class=n>file_path</span>
</span></span><span class=line><span class=cl>                <span class=p>}</span>
</span></span><span class=line><span class=cl>                <span class=n>album_info</span><span class=o>.</span><span class=n>tracks</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>track_info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error procesando pista </span><span class=si>{</span><span class=n>file_path</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Ordenar pistas por n√∫mero</span>
</span></span><span class=line><span class=cl>        <span class=n>album_info</span><span class=o>.</span><span class=n>tracks</span><span class=o>.</span><span class=n>sort</span><span class=p>(</span><span class=n>key</span><span class=o>=</span><span class=k>lambda</span> <span class=n>x</span><span class=p>:</span> <span class=n>x</span><span class=p>[</span><span class=s1>&#39;number&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>album_info</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_get_tag</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>audio_file</span><span class=p>,</span> <span class=o>*</span><span class=n>tag_names</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Obtiene el valor de un tag, probando m√∫ltiples nombres&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>tag_name</span> <span class=ow>in</span> <span class=n>tag_names</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>tag_name</span> <span class=ow>in</span> <span class=n>audio_file</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>value</span> <span class=o>=</span> <span class=n>audio_file</span><span class=p>[</span><span class=n>tag_name</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=nb>isinstance</span><span class=p>(</span><span class=n>value</span><span class=p>,</span> <span class=nb>list</span><span class=p>)</span> <span class=ow>and</span> <span class=n>value</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=k>return</span> <span class=nb>str</span><span class=p>(</span><span class=n>value</span><span class=p>[</span><span class=mi>0</span><span class=p>])</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>                    <span class=k>elif</span> <span class=n>value</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=k>return</span> <span class=nb>str</span><span class=p>(</span><span class=n>value</span><span class=p>)</span><span class=o>.</span><span class=n>strip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=k>except</span> <span class=p>(</span><span class=ne>KeyError</span><span class=p>,</span> <span class=ne>AttributeError</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>continue</span>
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>MusicBrainzEnricher</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Enriquece la informaci√≥n del √°lbum usando MusicBrainz&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>enrich_album_info</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>album_info</span><span class=p>:</span> <span class=n>AlbumInfo</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>AlbumInfo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Enriquece la informaci√≥n del √°lbum&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Intentar con MBID primero</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>album_info</span><span class=o>.</span><span class=n>mbid</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>enriched</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_get_info_by_mbid</span><span class=p>(</span><span class=n>album_info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>enriched</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>album_info</span> <span class=o>=</span> <span class=n>enriched</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Si no tiene MBID o no se encontr√≥, buscar por artista y √°lbum</span>
</span></span><span class=line><span class=cl>        <span class=k>elif</span> <span class=n>album_info</span><span class=o>.</span><span class=n>artist</span> <span class=ow>and</span> <span class=n>album_info</span><span class=o>.</span><span class=n>album</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>enriched</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_search_by_artist_album</span><span class=p>(</span><span class=n>album_info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>enriched</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>album_info</span> <span class=o>=</span> <span class=n>enriched</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Generar enlaces para c√≥digos QR</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Generando enlaces para c√≥digos QR...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>QRLinkGenerator</span><span class=o>.</span><span class=n>generate_qr_links</span><span class=p>(</span><span class=n>album_info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>album_info</span><span class=o>.</span><span class=n>artist</span> <span class=ow>or</span> <span class=ow>not</span> <span class=n>album_info</span><span class=o>.</span><span class=n>album</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=s2>&#34;No se pudo enriquecer la informaci√≥n desde MusicBrainz&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>album_info</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_get_info_by_mbid</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>album_info</span><span class=p>:</span> <span class=n>AlbumInfo</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>AlbumInfo</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Obtiene informaci√≥n usando el MBID&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>result</span> <span class=o>=</span> <span class=n>musicbrainzngs</span><span class=o>.</span><span class=n>get_release_by_id</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>album_info</span><span class=o>.</span><span class=n>mbid</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>includes</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;artist-credits&#39;</span><span class=p>,</span> <span class=s1>&#39;release-groups&#39;</span><span class=p>,</span> <span class=s1>&#39;labels&#39;</span><span class=p>,</span> <span class=s1>&#39;recordings&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_parse_musicbrainz_result</span><span class=p>(</span><span class=n>result</span><span class=p>[</span><span class=s1>&#39;release&#39;</span><span class=p>],</span> <span class=n>album_info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error consultando MusicBrainz por MBID </span><span class=si>{</span><span class=n>album_info</span><span class=o>.</span><span class=n>mbid</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_search_by_artist_album</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>album_info</span><span class=p>:</span> <span class=n>AlbumInfo</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>AlbumInfo</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Busca informaci√≥n por artista y √°lbum&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>results</span> <span class=o>=</span> <span class=n>musicbrainzngs</span><span class=o>.</span><span class=n>search_releases</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>artist</span><span class=o>=</span><span class=n>album_info</span><span class=o>.</span><span class=n>artist</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>release</span><span class=o>=</span><span class=n>album_info</span><span class=o>.</span><span class=n>album</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>limit</span><span class=o>=</span><span class=mi>5</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>results</span><span class=p>[</span><span class=s1>&#39;release-list&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=c1># Tomar el primer resultado</span>
</span></span><span class=line><span class=cl>                <span class=n>release</span> <span class=o>=</span> <span class=n>results</span><span class=p>[</span><span class=s1>&#39;release-list&#39;</span><span class=p>][</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># Obtener informaci√≥n completa</span>
</span></span><span class=line><span class=cl>                <span class=n>detailed_result</span> <span class=o>=</span> <span class=n>musicbrainzngs</span><span class=o>.</span><span class=n>get_release_by_id</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                    <span class=n>release</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>],</span>
</span></span><span class=line><span class=cl>                    <span class=n>includes</span><span class=o>=</span><span class=p>[</span><span class=s1>&#39;artist-credits&#39;</span><span class=p>,</span> <span class=s1>&#39;release-groups&#39;</span><span class=p>,</span> <span class=s1>&#39;labels&#39;</span><span class=p>,</span> <span class=s1>&#39;recordings&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=bp>self</span><span class=o>.</span><span class=n>_parse_musicbrainz_result</span><span class=p>(</span><span class=n>detailed_result</span><span class=p>[</span><span class=s1>&#39;release&#39;</span><span class=p>],</span> <span class=n>album_info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error buscando en MusicBrainz: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_parse_musicbrainz_result</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>release</span><span class=p>,</span> <span class=n>original_info</span><span class=p>:</span> <span class=n>AlbumInfo</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>AlbumInfo</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Parsea el resultado de MusicBrainz&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>enriched</span> <span class=o>=</span> <span class=n>AlbumInfo</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Mantener informaci√≥n original como fallback</span>
</span></span><span class=line><span class=cl>        <span class=n>enriched</span><span class=o>.</span><span class=n>artist</span> <span class=o>=</span> <span class=n>original_info</span><span class=o>.</span><span class=n>artist</span>
</span></span><span class=line><span class=cl>        <span class=n>enriched</span><span class=o>.</span><span class=n>album</span> <span class=o>=</span> <span class=n>original_info</span><span class=o>.</span><span class=n>album</span>
</span></span><span class=line><span class=cl>        <span class=n>enriched</span><span class=o>.</span><span class=n>tracks</span> <span class=o>=</span> <span class=n>original_info</span><span class=o>.</span><span class=n>tracks</span>
</span></span><span class=line><span class=cl>        <span class=n>enriched</span><span class=o>.</span><span class=n>genres</span> <span class=o>=</span> <span class=n>original_info</span><span class=o>.</span><span class=n>genres</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Enriquecer con datos de MusicBrainz</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=c1># Artista</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=s1>&#39;artist-credit&#39;</span> <span class=ow>in</span> <span class=n>release</span> <span class=ow>and</span> <span class=n>release</span><span class=p>[</span><span class=s1>&#39;artist-credit&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=n>artist_names</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>                <span class=n>artist_mbids</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>ac</span> <span class=ow>in</span> <span class=n>release</span><span class=p>[</span><span class=s1>&#39;artist-credit&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=s1>&#39;artist&#39;</span> <span class=ow>in</span> <span class=n>ac</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>artist_names</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>ac</span><span class=p>[</span><span class=s1>&#39;artist&#39;</span><span class=p>][</span><span class=s1>&#39;name&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                        <span class=c1># Extraer MBID del artista</span>
</span></span><span class=line><span class=cl>                        <span class=k>if</span> <span class=s1>&#39;id&#39;</span> <span class=ow>in</span> <span class=n>ac</span><span class=p>[</span><span class=s1>&#39;artist&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                            <span class=n>artist_mbids</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>ac</span><span class=p>[</span><span class=s1>&#39;artist&#39;</span><span class=p>][</span><span class=s1>&#39;id&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>artist_names</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>enriched</span><span class=o>.</span><span class=n>artist</span> <span class=o>=</span> <span class=s1>&#39;, &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>artist_names</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>artist_mbids</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>enriched</span><span class=o>.</span><span class=n>artist_mbid</span> <span class=o>=</span> <span class=n>artist_mbids</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>  <span class=c1># Usar el primer artista</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># √Ålbum</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=s1>&#39;title&#39;</span> <span class=ow>in</span> <span class=n>release</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>enriched</span><span class=o>.</span><span class=n>album</span> <span class=o>=</span> <span class=n>release</span><span class=p>[</span><span class=s1>&#39;title&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Fecha</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=s1>&#39;date&#39;</span> <span class=ow>in</span> <span class=n>release</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>enriched</span><span class=o>.</span><span class=n>date</span> <span class=o>=</span> <span class=n>release</span><span class=p>[</span><span class=s1>&#39;date&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>original_info</span><span class=o>.</span><span class=n>date</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>enriched</span><span class=o>.</span><span class=n>date</span> <span class=o>=</span> <span class=n>original_info</span><span class=o>.</span><span class=n>date</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Sello discogr√°fico</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=s1>&#39;label-info-list&#39;</span> <span class=ow>in</span> <span class=n>release</span> <span class=ow>and</span> <span class=n>release</span><span class=p>[</span><span class=s1>&#39;label-info-list&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=n>labels</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>                <span class=k>for</span> <span class=n>label_info</span> <span class=ow>in</span> <span class=n>release</span><span class=p>[</span><span class=s1>&#39;label-info-list&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                    <span class=k>if</span> <span class=s1>&#39;label&#39;</span> <span class=ow>in</span> <span class=n>label_info</span> <span class=ow>and</span> <span class=s1>&#39;name&#39;</span> <span class=ow>in</span> <span class=n>label_info</span><span class=p>[</span><span class=s1>&#39;label&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                        <span class=n>labels</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>label_info</span><span class=p>[</span><span class=s1>&#39;label&#39;</span><span class=p>][</span><span class=s1>&#39;name&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>labels</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>enriched</span><span class=o>.</span><span class=n>label</span> <span class=o>=</span> <span class=s1>&#39;, &#39;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>labels</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>elif</span> <span class=n>original_info</span><span class=o>.</span><span class=n>label</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>enriched</span><span class=o>.</span><span class=n>label</span> <span class=o>=</span> <span class=n>original_info</span><span class=o>.</span><span class=n>label</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># G√©neros (desde release-group)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=s1>&#39;release-group&#39;</span> <span class=ow>in</span> <span class=n>release</span> <span class=ow>and</span> <span class=s1>&#39;tag-list&#39;</span> <span class=ow>in</span> <span class=n>release</span><span class=p>[</span><span class=s1>&#39;release-group&#39;</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>                <span class=n>genres</span> <span class=o>=</span> <span class=p>[</span><span class=n>tag</span><span class=p>[</span><span class=s1>&#39;name&#39;</span><span class=p>]</span> <span class=k>for</span> <span class=n>tag</span> <span class=ow>in</span> <span class=n>release</span><span class=p>[</span><span class=s1>&#39;release-group&#39;</span><span class=p>][</span><span class=s1>&#39;tag-list&#39;</span><span class=p>]]</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>genres</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>enriched</span><span class=o>.</span><span class=n>genres</span> <span class=o>=</span> <span class=n>genres</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># MBID</span>
</span></span><span class=line><span class=cl>            <span class=n>enriched</span><span class=o>.</span><span class=n>mbid</span> <span class=o>=</span> <span class=n>release</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># URL de portada (Cover Art Archive)</span>
</span></span><span class=line><span class=cl>            <span class=n>enriched</span><span class=o>.</span><span class=n>cover_art_url</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;https://coverartarchive.org/release/</span><span class=si>{</span><span class=n>release</span><span class=p>[</span><span class=s1>&#39;id&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>/front&#34;</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error parseando resultado de MusicBrainz: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>enriched</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CoverArtDownloader</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Descargador de portadas de √°lbumes&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>download_cover</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>album_info</span><span class=p>:</span> <span class=n>AlbumInfo</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Image</span><span class=o>.</span><span class=n>Image</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Descarga la portada del √°lbum y extrae la paleta de colores&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>cover_image</span> <span class=o>=</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Intentar desde Cover Art Archive si tenemos MBID</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>album_info</span><span class=o>.</span><span class=n>cover_art_url</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>cover_image</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_download_from_url</span><span class=p>(</span><span class=n>album_info</span><span class=o>.</span><span class=n>cover_art_url</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Buscar archivo de imagen en la carpeta si no se descarg√≥</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>cover_image</span> <span class=ow>and</span> <span class=n>album_info</span><span class=o>.</span><span class=n>tracks</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>folder_path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>album_info</span><span class=o>.</span><span class=n>tracks</span><span class=p>[</span><span class=mi>0</span><span class=p>][</span><span class=s1>&#39;file&#39;</span><span class=p>])</span><span class=o>.</span><span class=n>parent</span>
</span></span><span class=line><span class=cl>            <span class=n>cover_image</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_find_local_cover</span><span class=p>(</span><span class=n>folder_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Crear portada por defecto si no se encontr√≥ ninguna</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>cover_image</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>cover_image</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_create_default_cover</span><span class=p>(</span><span class=n>album_info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Extraer paleta de colores de la portada</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>cover_image</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>_extract_color_palette</span><span class=p>(</span><span class=n>album_info</span><span class=p>,</span> <span class=n>cover_image</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>cover_image</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_extract_color_palette</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>album_info</span><span class=p>:</span> <span class=n>AlbumInfo</span><span class=p>,</span> <span class=n>cover_image</span><span class=p>:</span> <span class=n>Image</span><span class=o>.</span><span class=n>Image</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Extrae la paleta de colores de la portada&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Extrayendo paleta de colores de la portada...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Extraer color dominante</span>
</span></span><span class=line><span class=cl>            <span class=n>dominant_color</span> <span class=o>=</span> <span class=n>ColorAnalyzer</span><span class=o>.</span><span class=n>extract_dominant_color</span><span class=p>(</span><span class=n>cover_image</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Realzar el color para el fondo</span>
</span></span><span class=line><span class=cl>            <span class=n>enhanced_bg</span> <span class=o>=</span> <span class=n>ColorAnalyzer</span><span class=o>.</span><span class=n>enhance_color</span><span class=p>(</span><span class=n>dominant_color</span><span class=p>,</span> <span class=n>saturation_boost</span><span class=o>=</span><span class=mf>0.8</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Generar paleta completa</span>
</span></span><span class=line><span class=cl>            <span class=n>album_info</span><span class=o>.</span><span class=n>color_palette</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;background&#39;</span><span class=p>:</span> <span class=n>enhanced_bg</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;text_primary&#39;</span><span class=p>:</span> <span class=n>ColorAnalyzer</span><span class=o>.</span><span class=n>get_contrast_color</span><span class=p>(</span><span class=n>enhanced_bg</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;text_secondary&#39;</span><span class=p>:</span> <span class=n>ColorAnalyzer</span><span class=o>.</span><span class=n>get_secondary_color</span><span class=p>(</span><span class=n>enhanced_bg</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;border&#39;</span><span class=p>:</span> <span class=n>ColorAnalyzer</span><span class=o>.</span><span class=n>get_border_color</span><span class=p>(</span><span class=n>enhanced_bg</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Paleta extra√≠da - Fondo: </span><span class=si>{</span><span class=n>enhanced_bg</span><span class=si>}</span><span class=s2>, Texto: </span><span class=si>{</span><span class=n>album_info</span><span class=o>.</span><span class=n>color_palette</span><span class=p>[</span><span class=s1>&#39;text_primary&#39;</span><span class=p>]</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error extrayendo paleta de colores: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=c1># Mantener paleta por defecto</span>
</span></span><span class=line><span class=cl>            <span class=n>album_info</span><span class=o>.</span><span class=n>color_palette</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;background&#39;</span><span class=p>:</span> <span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>,</span> <span class=mi>255</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;text_primary&#39;</span><span class=p>:</span> <span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;text_secondary&#39;</span><span class=p>:</span> <span class=p>(</span><span class=mi>80</span><span class=p>,</span> <span class=mi>80</span><span class=p>,</span> <span class=mi>80</span><span class=p>),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;border&#39;</span><span class=p>:</span> <span class=p>(</span><span class=mi>230</span><span class=p>,</span> <span class=mi>230</span><span class=p>,</span> <span class=mi>230</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_download_from_url</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>url</span><span class=p>:</span> <span class=nb>str</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Image</span><span class=o>.</span><span class=n>Image</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Descarga imagen desde URL&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>response</span> <span class=o>=</span> <span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>timeout</span><span class=o>=</span><span class=mi>10</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>response</span><span class=o>.</span><span class=n>raise_for_status</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>image</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>requests</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=n>url</span><span class=p>,</span> <span class=n>stream</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span><span class=o>.</span><span class=n>raw</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>image</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>        <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error descargando portada desde </span><span class=si>{</span><span class=n>url</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_find_local_cover</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>folder_path</span><span class=p>:</span> <span class=n>Path</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Optional</span><span class=p>[</span><span class=n>Image</span><span class=o>.</span><span class=n>Image</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Busca archivos de imagen en la carpeta&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>cover_names</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;cover&#39;</span><span class=p>,</span> <span class=s1>&#39;folder&#39;</span><span class=p>,</span> <span class=s1>&#39;front&#39;</span><span class=p>,</span> <span class=s1>&#39;album&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>image_extensions</span> <span class=o>=</span> <span class=p>[</span><span class=s1>&#39;.jpg&#39;</span><span class=p>,</span> <span class=s1>&#39;.jpeg&#39;</span><span class=p>,</span> <span class=s1>&#39;.png&#39;</span><span class=p>,</span> <span class=s1>&#39;.bmp&#39;</span><span class=p>,</span> <span class=s1>&#39;.tiff&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Buscar archivos espec√≠ficos</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>cover_name</span> <span class=ow>in</span> <span class=n>cover_names</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>ext</span> <span class=ow>in</span> <span class=n>image_extensions</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>cover_file</span> <span class=o>=</span> <span class=n>folder_path</span> <span class=o>/</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>cover_name</span><span class=si>}{</span><span class=n>ext</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>cover_file</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
</span></span><span class=line><span class=cl>                    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=k>return</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>cover_file</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                        <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error abriendo imagen </span><span class=si>{</span><span class=n>cover_file</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Buscar cualquier imagen</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>file_path</span> <span class=ow>in</span> <span class=n>folder_path</span><span class=o>.</span><span class=n>iterdir</span><span class=p>():</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>file_path</span><span class=o>.</span><span class=n>suffix</span><span class=o>.</span><span class=n>lower</span><span class=p>()</span> <span class=ow>in</span> <span class=n>image_extensions</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>return</span> <span class=n>Image</span><span class=o>.</span><span class=n>open</span><span class=p>(</span><span class=n>file_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>logger</span><span class=o>.</span><span class=n>warning</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error abriendo imagen </span><span class=si>{</span><span class=n>file_path</span><span class=si>}</span><span class=s2>: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=kc>None</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_create_default_cover</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>album_info</span><span class=p>:</span> <span class=n>AlbumInfo</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Image</span><span class=o>.</span><span class=n>Image</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Crea una portada por defecto con colores mejorados&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>size</span> <span class=o>=</span> <span class=mi>500</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Colores base m√°s atractivos</span>
</span></span><span class=line><span class=cl>        <span class=n>base_colors</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=mi>45</span><span class=p>,</span> <span class=mi>55</span><span class=p>,</span> <span class=mi>72</span><span class=p>),</span>    <span class=c1># Azul gris oscuro</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=mi>68</span><span class=p>,</span> <span class=mi>51</span><span class=p>,</span> <span class=mi>122</span><span class=p>),</span>   <span class=c1># P√∫rpura</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=mi>31</span><span class=p>,</span> <span class=mi>81</span><span class=p>,</span> <span class=mi>89</span><span class=p>),</span>    <span class=c1># Verde azulado</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=mi>120</span><span class=p>,</span> <span class=mi>53</span><span class=p>,</span> <span class=mi>15</span><span class=p>),</span>   <span class=c1># Marr√≥n c√°lido</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=mi>74</span><span class=p>,</span> <span class=mi>29</span><span class=p>,</span> <span class=mi>30</span><span class=p>),</span>    <span class=c1># Rojo oscuro</span>
</span></span><span class=line><span class=cl>            <span class=p>(</span><span class=mi>45</span><span class=p>,</span> <span class=mi>74</span><span class=p>,</span> <span class=mi>60</span><span class=p>),</span>    <span class=c1># Verde oscuro</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Elegir color base seg√∫n el nombre del √°lbum</span>
</span></span><span class=line><span class=cl>        <span class=n>color_index</span> <span class=o>=</span> <span class=nb>sum</span><span class=p>(</span><span class=nb>ord</span><span class=p>(</span><span class=n>c</span><span class=p>)</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=p>(</span><span class=n>album_info</span><span class=o>.</span><span class=n>album</span> <span class=ow>or</span> <span class=s2>&#34;default&#34;</span><span class=p>))</span> <span class=o>%</span> <span class=nb>len</span><span class=p>(</span><span class=n>base_colors</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>base_color</span> <span class=o>=</span> <span class=n>base_colors</span><span class=p>[</span><span class=n>color_index</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Crear imagen con gradiente</span>
</span></span><span class=line><span class=cl>        <span class=n>image</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=s1>&#39;RGB&#39;</span><span class=p>,</span> <span class=p>(</span><span class=n>size</span><span class=p>,</span> <span class=n>size</span><span class=p>),</span> <span class=n>base_color</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>draw</span> <span class=o>=</span> <span class=n>ImageDraw</span><span class=o>.</span><span class=n>Draw</span><span class=p>(</span><span class=n>image</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Gradiente sutil</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>y</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>size</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>ratio</span> <span class=o>=</span> <span class=n>y</span> <span class=o>/</span> <span class=n>size</span>
</span></span><span class=line><span class=cl>            <span class=n>r</span><span class=p>,</span> <span class=n>g</span><span class=p>,</span> <span class=n>b</span> <span class=o>=</span> <span class=n>base_color</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Crear variaci√≥n tonal</span>
</span></span><span class=line><span class=cl>            <span class=n>new_r</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>min</span><span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=nb>int</span><span class=p>(</span><span class=n>r</span> <span class=o>+</span> <span class=n>ratio</span> <span class=o>*</span> <span class=mi>30</span> <span class=o>-</span> <span class=mi>15</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>            <span class=n>new_g</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>min</span><span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=nb>int</span><span class=p>(</span><span class=n>g</span> <span class=o>+</span> <span class=n>ratio</span> <span class=o>*</span> <span class=mi>30</span> <span class=o>-</span> <span class=mi>15</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>            <span class=n>new_b</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mi>0</span><span class=p>,</span> <span class=nb>min</span><span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=nb>int</span><span class=p>(</span><span class=n>b</span> <span class=o>+</span> <span class=n>ratio</span> <span class=o>*</span> <span class=mi>30</span> <span class=o>-</span> <span class=mi>15</span><span class=p>)))</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>draw</span><span class=o>.</span><span class=n>line</span><span class=p>([(</span><span class=mi>0</span><span class=p>,</span> <span class=n>y</span><span class=p>),</span> <span class=p>(</span><span class=n>size</span><span class=p>,</span> <span class=n>y</span><span class=p>)],</span> <span class=n>fill</span><span class=o>=</span><span class=p>(</span><span class=n>new_r</span><span class=p>,</span> <span class=n>new_g</span><span class=p>,</span> <span class=n>new_b</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># A√±adir patr√≥n geom√©trico sutil</span>
</span></span><span class=line><span class=cl>        <span class=n>pattern_color</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span><span class=nb>min</span><span class=p>(</span><span class=mi>255</span><span class=p>,</span> <span class=n>c</span> <span class=o>+</span> <span class=mi>20</span><span class=p>)</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>base_color</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># C√≠rculos conc√©ntricos</span>
</span></span><span class=line><span class=cl>        <span class=n>center</span> <span class=o>=</span> <span class=n>size</span> <span class=o>//</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>radius</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=mi>50</span><span class=p>,</span> <span class=mi>200</span><span class=p>,</span> <span class=mi>40</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>draw</span><span class=o>.</span><span class=n>ellipse</span><span class=p>([</span>
</span></span><span class=line><span class=cl>                <span class=n>center</span> <span class=o>-</span> <span class=n>radius</span><span class=p>,</span> <span class=n>center</span> <span class=o>-</span> <span class=n>radius</span><span class=p>,</span>
</span></span><span class=line><span class=cl>                <span class=n>center</span> <span class=o>+</span> <span class=n>radius</span><span class=p>,</span> <span class=n>center</span> <span class=o>+</span> <span class=n>radius</span>
</span></span><span class=line><span class=cl>            <span class=p>],</span> <span class=n>outline</span><span class=o>=</span><span class=n>pattern_color</span><span class=p>,</span> <span class=n>width</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Texto con mejor tipograf√≠a</span>
</span></span><span class=line><span class=cl>        <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>title_font</span> <span class=o>=</span> <span class=n>ImageFont</span><span class=o>.</span><span class=n>truetype</span><span class=p>(</span><span class=s2>&#34;/usr/share/fonts/truetype/dejavu/DejaVuSans-Bold.ttf&#34;</span><span class=p>,</span> <span class=mi>40</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>artist_font</span> <span class=o>=</span> <span class=n>ImageFont</span><span class=o>.</span><span class=n>truetype</span><span class=p>(</span><span class=s2>&#34;/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf&#34;</span><span class=p>,</span> <span class=mi>30</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>except</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>title_font</span> <span class=o>=</span> <span class=n>ImageFont</span><span class=o>.</span><span class=n>load_default</span><span class=p>()</span>
</span></span><span class=line><span class=cl>            <span class=n>artist_font</span> <span class=o>=</span> <span class=n>ImageFont</span><span class=o>.</span><span class=n>load_default</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Colores de texto contrastantes</span>
</span></span><span class=line><span class=cl>        <span class=n>text_color</span> <span class=o>=</span> <span class=n>ColorAnalyzer</span><span class=o>.</span><span class=n>get_contrast_color</span><span class=p>(</span><span class=n>base_color</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>shadow_color</span> <span class=o>=</span> <span class=nb>tuple</span><span class=p>(</span><span class=n>c</span> <span class=o>//</span> <span class=mi>3</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>text_color</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Texto del √°lbum</span>
</span></span><span class=line><span class=cl>        <span class=n>album_text</span> <span class=o>=</span> <span class=p>(</span><span class=n>album_info</span><span class=o>.</span><span class=n>album</span> <span class=ow>or</span> <span class=s2>&#34;Album&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>artist_text</span> <span class=o>=</span> <span class=p>(</span><span class=n>album_info</span><span class=o>.</span><span class=n>artist</span> <span class=ow>or</span> <span class=s2>&#34;Artist&#34;</span><span class=p>)</span><span class=o>.</span><span class=n>upper</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Posicionar texto del √°lbum</span>
</span></span><span class=line><span class=cl>        <span class=n>bbox</span> <span class=o>=</span> <span class=n>draw</span><span class=o>.</span><span class=n>textbbox</span><span class=p>((</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span> <span class=n>album_text</span><span class=p>,</span> <span class=n>font</span><span class=o>=</span><span class=n>title_font</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>text_width</span> <span class=o>=</span> <span class=n>bbox</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>-</span> <span class=n>bbox</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span> <span class=o>=</span> <span class=p>(</span><span class=n>size</span> <span class=o>-</span> <span class=n>text_width</span><span class=p>)</span> <span class=o>//</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>        <span class=n>y</span> <span class=o>=</span> <span class=nb>int</span><span class=p>(</span><span class=n>size</span> <span class=o>*</span> <span class=mf>0.7</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Sombra sutil</span>
</span></span><span class=line><span class=cl>        <span class=n>draw</span><span class=o>.</span><span class=n>text</span><span class=p>((</span><span class=n>x</span> <span class=o>+</span> <span class=mi>2</span><span class=p>,</span> <span class=n>y</span> <span class=o>+</span> <span class=mi>2</span><span class=p>),</span> <span class=n>album_text</span><span class=p>,</span> <span class=n>fill</span><span class=o>=</span><span class=n>shadow_color</span><span class=p>,</span> <span class=n>font</span><span class=o>=</span><span class=n>title_font</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>draw</span><span class=o>.</span><span class=n>text</span><span class=p>((</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>),</span> <span class=n>album_text</span><span class=p>,</span> <span class=n>fill</span><span class=o>=</span><span class=n>text_color</span><span class=p>,</span> <span class=n>font</span><span class=o>=</span><span class=n>title_font</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Texto del artista</span>
</span></span><span class=line><span class=cl>        <span class=n>bbox</span> <span class=o>=</span> <span class=n>draw</span><span class=o>.</span><span class=n>textbbox</span><span class=p>((</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span> <span class=n>artist_text</span><span class=p>,</span> <span class=n>font</span><span class=o>=</span><span class=n>artist_font</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>text_width</span> <span class=o>=</span> <span class=n>bbox</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>-</span> <span class=n>bbox</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>x</span> <span class=o>=</span> <span class=p>(</span><span class=n>size</span> <span class=o>-</span> <span class=n>text_width</span><span class=p>)</span> <span class=o>//</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>        <span class=n>y</span> <span class=o>+=</span> <span class=mi>50</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>draw</span><span class=o>.</span><span class=n>text</span><span class=p>((</span><span class=n>x</span> <span class=o>+</span> <span class=mi>1</span><span class=p>,</span> <span class=n>y</span> <span class=o>+</span> <span class=mi>1</span><span class=p>),</span> <span class=n>artist_text</span><span class=p>,</span> <span class=n>fill</span><span class=o>=</span><span class=n>shadow_color</span><span class=p>,</span> <span class=n>font</span><span class=o>=</span><span class=n>artist_font</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>draw</span><span class=o>.</span><span class=n>text</span><span class=p>((</span><span class=n>x</span><span class=p>,</span> <span class=n>y</span><span class=p>),</span> <span class=n>artist_text</span><span class=p>,</span> <span class=n>fill</span><span class=o>=</span><span class=n>text_color</span><span class=p>,</span> <span class=n>font</span><span class=o>=</span><span class=n>artist_font</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>image</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>class</span> <span class=nc>CardGenerator</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Generador de tarjetas de √°lbumes&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=fm>__init__</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>setup_fonts</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>setup_fonts</span><span class=p>(</span><span class=bp>self</span><span class=p>):</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Configura las fuentes&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=bp>self</span><span class=o>.</span><span class=n>fonts</span> <span class=o>=</span> <span class=p>{}</span>
</span></span><span class=line><span class=cl>        <span class=n>font_paths</span> <span class=o>=</span> <span class=p>[</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;/usr/share/fonts/truetype/dejavu/DejaVuSans-Bold.ttf&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;/usr/share/fonts/truetype/dejavu/DejaVuSans.ttf&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;/usr/share/fonts/truetype/liberation/LiberationSans-Bold.ttf&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;/usr/share/fonts/truetype/liberation/LiberationSans-Regular.ttf&#34;</span><span class=p>,</span>
</span></span><span class=line><span class=cl>        <span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>font_path</span> <span class=ow>in</span> <span class=n>font_paths</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>os</span><span class=o>.</span><span class=n>path</span><span class=o>.</span><span class=n>exists</span><span class=p>(</span><span class=n>font_path</span><span class=p>):</span>
</span></span><span class=line><span class=cl>                <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>fonts</span><span class=p>[</span><span class=s1>&#39;title&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>ImageFont</span><span class=o>.</span><span class=n>truetype</span><span class=p>(</span><span class=n>font_path</span><span class=p>,</span> <span class=mi>32</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>fonts</span><span class=p>[</span><span class=s1>&#39;artist&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>ImageFont</span><span class=o>.</span><span class=n>truetype</span><span class=p>(</span><span class=n>font_path</span><span class=p>,</span> <span class=mi>28</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>fonts</span><span class=p>[</span><span class=s1>&#39;info&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>ImageFont</span><span class=o>.</span><span class=n>truetype</span><span class=p>(</span><span class=n>font_path</span><span class=p>,</span> <span class=mi>20</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=bp>self</span><span class=o>.</span><span class=n>fonts</span><span class=p>[</span><span class=s1>&#39;track&#39;</span><span class=p>]</span> <span class=o>=</span> <span class=n>ImageFont</span><span class=o>.</span><span class=n>truetype</span><span class=p>(</span><span class=n>font_path</span><span class=p>,</span> <span class=mi>18</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                    <span class=k>break</span>
</span></span><span class=line><span class=cl>                <span class=k>except</span> <span class=ne>Exception</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=k>continue</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Fallback a fuente por defecto</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=bp>self</span><span class=o>.</span><span class=n>fonts</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=bp>self</span><span class=o>.</span><span class=n>fonts</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;title&#39;</span><span class=p>:</span> <span class=n>ImageFont</span><span class=o>.</span><span class=n>load_default</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;artist&#39;</span><span class=p>:</span> <span class=n>ImageFont</span><span class=o>.</span><span class=n>load_default</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;info&#39;</span><span class=p>:</span> <span class=n>ImageFont</span><span class=o>.</span><span class=n>load_default</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>                <span class=s1>&#39;track&#39;</span><span class=p>:</span> <span class=n>ImageFont</span><span class=o>.</span><span class=n>load_default</span><span class=p>(),</span>
</span></span><span class=line><span class=cl>            <span class=p>}</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_front_card</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>album_info</span><span class=p>:</span> <span class=n>AlbumInfo</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Image</span><span class=o>.</span><span class=n>Image</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Genera la cara A (frontal) de la tarjeta con colores din√°micos&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># Obtener paleta de colores</span>
</span></span><span class=line><span class=cl>        <span class=n>bg_color</span> <span class=o>=</span> <span class=n>album_info</span><span class=o>.</span><span class=n>color_palette</span><span class=p>[</span><span class=s1>&#39;background&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>text_primary</span> <span class=o>=</span> <span class=n>album_info</span><span class=o>.</span><span class=n>color_palette</span><span class=p>[</span><span class=s1>&#39;text_primary&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>text_secondary</span> <span class=o>=</span> <span class=n>album_info</span><span class=o>.</span><span class=n>color_palette</span><span class=p>[</span><span class=s1>&#39;text_secondary&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>border_color</span> <span class=o>=</span> <span class=n>album_info</span><span class=o>.</span><span class=n>color_palette</span><span class=p>[</span><span class=s1>&#39;border&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Crear imagen base con color de fondo din√°mico</span>
</span></span><span class=line><span class=cl>        <span class=n>image</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=s1>&#39;RGB&#39;</span><span class=p>,</span> <span class=p>(</span><span class=n>CARD_WIDTH</span><span class=p>,</span> <span class=n>CARD_HEIGHT</span><span class=p>),</span> <span class=n>bg_color</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>draw</span> <span class=o>=</span> <span class=n>ImageDraw</span><span class=o>.</span><span class=n>Draw</span><span class=p>(</span><span class=n>image</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># √Årea de la portada (51x51mm en la parte superior)</span>
</span></span><span class=line><span class=cl>        <span class=n>cover_y</span> <span class=o>=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>        <span class=n>cover_x</span> <span class=o>=</span> <span class=p>(</span><span class=n>CARD_WIDTH</span> <span class=o>-</span> <span class=n>COVER_SIZE</span><span class=p>)</span> <span class=o>//</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Redimensionar y colocar portada</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>album_info</span><span class=o>.</span><span class=n>cover_image</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>cover</span> <span class=o>=</span> <span class=n>album_info</span><span class=o>.</span><span class=n>cover_image</span><span class=o>.</span><span class=n>resize</span><span class=p>((</span><span class=n>COVER_SIZE</span><span class=p>,</span> <span class=n>COVER_SIZE</span><span class=p>),</span> <span class=n>Image</span><span class=o>.</span><span class=n>Resampling</span><span class=o>.</span><span class=n>LANCZOS</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>image</span><span class=o>.</span><span class=n>paste</span><span class=p>(</span><span class=n>cover</span><span class=p>,</span> <span class=p>(</span><span class=n>cover_x</span><span class=p>,</span> <span class=n>cover_y</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Marco sutil para la portada</span>
</span></span><span class=line><span class=cl>        <span class=n>frame_color</span> <span class=o>=</span> <span class=n>ColorAnalyzer</span><span class=o>.</span><span class=n>get_border_color</span><span class=p>(</span><span class=n>bg_color</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>draw</span><span class=o>.</span><span class=n>rectangle</span><span class=p>([</span>
</span></span><span class=line><span class=cl>            <span class=n>cover_x</span> <span class=o>-</span> <span class=mi>2</span><span class=p>,</span> <span class=n>cover_y</span> <span class=o>-</span> <span class=mi>2</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=n>cover_x</span> <span class=o>+</span> <span class=n>COVER_SIZE</span> <span class=o>+</span> <span class=mi>2</span><span class=p>,</span> <span class=n>cover_y</span> <span class=o>+</span> <span class=n>COVER_SIZE</span> <span class=o>+</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>        <span class=p>],</span> <span class=n>outline</span><span class=o>=</span><span class=n>frame_color</span><span class=p>,</span> <span class=n>width</span><span class=o>=</span><span class=mi>3</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># √Årea de texto (30mm en la parte inferior)</span>
</span></span><span class=line><span class=cl>        <span class=n>text_y_start</span> <span class=o>=</span> <span class=n>cover_y</span> <span class=o>+</span> <span class=n>COVER_SIZE</span> <span class=o>+</span> <span class=mi>20</span>
</span></span><span class=line><span class=cl>        <span class=n>text_area_height</span> <span class=o>=</span> <span class=n>CARD_HEIGHT</span> <span class=o>-</span> <span class=n>text_y_start</span> <span class=o>-</span> <span class=mi>20</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Informaci√≥n del √°lbum</span>
</span></span><span class=line><span class=cl>        <span class=n>current_y</span> <span class=o>=</span> <span class=n>text_y_start</span>
</span></span><span class=line><span class=cl>        <span class=n>margin</span> <span class=o>=</span> <span class=mi>15</span>
</span></span><span class=line><span class=cl>        <span class=n>line_height</span> <span class=o>=</span> <span class=mi>35</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># T√≠tulo del √°lbum</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>album_info</span><span class=o>.</span><span class=n>album</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>text</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_wrap_text</span><span class=p>(</span><span class=n>draw</span><span class=p>,</span> <span class=n>album_info</span><span class=o>.</span><span class=n>album</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>fonts</span><span class=p>[</span><span class=s1>&#39;title&#39;</span><span class=p>],</span> <span class=n>CARD_WIDTH</span> <span class=o>-</span> <span class=mi>2</span> <span class=o>*</span> <span class=n>margin</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>draw</span><span class=o>.</span><span class=n>text</span><span class=p>((</span><span class=n>margin</span><span class=p>,</span> <span class=n>current_y</span><span class=p>),</span> <span class=n>line</span><span class=p>,</span> <span class=n>fill</span><span class=o>=</span><span class=n>text_primary</span><span class=p>,</span> <span class=n>font</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>fonts</span><span class=p>[</span><span class=s1>&#39;title&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=n>current_y</span> <span class=o>+=</span> <span class=n>line_height</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>current_y</span> <span class=o>+=</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Artista</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>album_info</span><span class=o>.</span><span class=n>artist</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>text</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_wrap_text</span><span class=p>(</span><span class=n>draw</span><span class=p>,</span> <span class=n>album_info</span><span class=o>.</span><span class=n>artist</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>fonts</span><span class=p>[</span><span class=s1>&#39;artist&#39;</span><span class=p>],</span> <span class=n>CARD_WIDTH</span> <span class=o>-</span> <span class=mi>2</span> <span class=o>*</span> <span class=n>margin</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>draw</span><span class=o>.</span><span class=n>text</span><span class=p>((</span><span class=n>margin</span><span class=p>,</span> <span class=n>current_y</span><span class=p>),</span> <span class=n>line</span><span class=p>,</span> <span class=n>fill</span><span class=o>=</span><span class=n>text_secondary</span><span class=p>,</span> <span class=n>font</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>fonts</span><span class=p>[</span><span class=s1>&#39;artist&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=n>current_y</span> <span class=o>+=</span> <span class=n>line_height</span> <span class=o>-</span> <span class=mi>5</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>current_y</span> <span class=o>+=</span> <span class=mi>15</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># G√©neros</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>album_info</span><span class=o>.</span><span class=n>genres</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>genres_text</span> <span class=o>=</span> <span class=s2>&#34; ‚Ä¢ &#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>album_info</span><span class=o>.</span><span class=n>genres</span><span class=p>[:</span><span class=mi>3</span><span class=p>])</span>  <span class=c1># M√°ximo 3 g√©neros</span>
</span></span><span class=line><span class=cl>            <span class=n>text</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_wrap_text</span><span class=p>(</span><span class=n>draw</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;G√©neros: </span><span class=si>{</span><span class=n>genres_text</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>fonts</span><span class=p>[</span><span class=s1>&#39;info&#39;</span><span class=p>],</span> <span class=n>CARD_WIDTH</span> <span class=o>-</span> <span class=mi>2</span> <span class=o>*</span> <span class=n>margin</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>draw</span><span class=o>.</span><span class=n>text</span><span class=p>((</span><span class=n>margin</span><span class=p>,</span> <span class=n>current_y</span><span class=p>),</span> <span class=n>line</span><span class=p>,</span> <span class=n>fill</span><span class=o>=</span><span class=n>text_secondary</span><span class=p>,</span> <span class=n>font</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>fonts</span><span class=p>[</span><span class=s1>&#39;info&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=n>current_y</span> <span class=o>+=</span> <span class=mi>25</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Sello</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>album_info</span><span class=o>.</span><span class=n>label</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>text</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_wrap_text</span><span class=p>(</span><span class=n>draw</span><span class=p>,</span> <span class=sa>f</span><span class=s2>&#34;Sello: </span><span class=si>{</span><span class=n>album_info</span><span class=o>.</span><span class=n>label</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>fonts</span><span class=p>[</span><span class=s1>&#39;info&#39;</span><span class=p>],</span> <span class=n>CARD_WIDTH</span> <span class=o>-</span> <span class=mi>2</span> <span class=o>*</span> <span class=n>margin</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>line</span> <span class=ow>in</span> <span class=n>text</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>draw</span><span class=o>.</span><span class=n>text</span><span class=p>((</span><span class=n>margin</span><span class=p>,</span> <span class=n>current_y</span><span class=p>),</span> <span class=n>line</span><span class=p>,</span> <span class=n>fill</span><span class=o>=</span><span class=n>text_secondary</span><span class=p>,</span> <span class=n>font</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>fonts</span><span class=p>[</span><span class=s1>&#39;info&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=n>current_y</span> <span class=o>+=</span> <span class=mi>25</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Fecha</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>album_info</span><span class=o>.</span><span class=n>date</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>draw</span><span class=o>.</span><span class=n>text</span><span class=p>((</span><span class=n>margin</span><span class=p>,</span> <span class=n>current_y</span><span class=p>),</span> <span class=sa>f</span><span class=s2>&#34;Fecha: </span><span class=si>{</span><span class=n>album_info</span><span class=o>.</span><span class=n>date</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>,</span> <span class=n>fill</span><span class=o>=</span><span class=n>text_secondary</span><span class=p>,</span> <span class=n>font</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>fonts</span><span class=p>[</span><span class=s1>&#39;info&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Borde sutil de la tarjeta</span>
</span></span><span class=line><span class=cl>        <span class=n>draw</span><span class=o>.</span><span class=n>rectangle</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>CARD_WIDTH</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=n>CARD_HEIGHT</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span> <span class=n>outline</span><span class=o>=</span><span class=n>border_color</span><span class=p>,</span> <span class=n>width</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>image</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>generate_back_card</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>album_info</span><span class=p>:</span> <span class=n>AlbumInfo</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>Image</span><span class=o>.</span><span class=n>Image</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Genera la cara B (tracklist) de la tarjeta con colores din√°micos y c√≥digos QR&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=c1># Obtener paleta de colores</span>
</span></span><span class=line><span class=cl>        <span class=n>bg_color</span> <span class=o>=</span> <span class=n>album_info</span><span class=o>.</span><span class=n>color_palette</span><span class=p>[</span><span class=s1>&#39;background&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>text_primary</span> <span class=o>=</span> <span class=n>album_info</span><span class=o>.</span><span class=n>color_palette</span><span class=p>[</span><span class=s1>&#39;text_primary&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>text_secondary</span> <span class=o>=</span> <span class=n>album_info</span><span class=o>.</span><span class=n>color_palette</span><span class=p>[</span><span class=s1>&#39;text_secondary&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=n>border_color</span> <span class=o>=</span> <span class=n>album_info</span><span class=o>.</span><span class=n>color_palette</span><span class=p>[</span><span class=s1>&#39;border&#39;</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Crear imagen base con color de fondo din√°mico</span>
</span></span><span class=line><span class=cl>        <span class=n>image</span> <span class=o>=</span> <span class=n>Image</span><span class=o>.</span><span class=n>new</span><span class=p>(</span><span class=s1>&#39;RGB&#39;</span><span class=p>,</span> <span class=p>(</span><span class=n>CARD_WIDTH</span><span class=p>,</span> <span class=n>CARD_HEIGHT</span><span class=p>),</span> <span class=n>bg_color</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>draw</span> <span class=o>=</span> <span class=n>ImageDraw</span><span class=o>.</span><span class=n>Draw</span><span class=p>(</span><span class=n>image</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>margin</span> <span class=o>=</span> <span class=mi>20</span>
</span></span><span class=line><span class=cl>        <span class=n>current_y</span> <span class=o>=</span> <span class=n>margin</span> <span class=o>+</span> <span class=mi>10</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># T√≠tulo con informaci√≥n del √°lbum (en lugar de &#34;TRACKLIST&#34;)</span>
</span></span><span class=line><span class=cl>        <span class=n>album_header</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>album_info</span><span class=o>.</span><span class=n>artist</span><span class=si>}</span><span class=s2> - </span><span class=si>{</span><span class=n>album_info</span><span class=o>.</span><span class=n>album</span><span class=si>}</span><span class=s2>&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>album_header</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_truncate_text</span><span class=p>(</span><span class=n>draw</span><span class=p>,</span> <span class=n>album_header</span><span class=p>,</span> <span class=bp>self</span><span class=o>.</span><span class=n>fonts</span><span class=p>[</span><span class=s1>&#39;title&#39;</span><span class=p>],</span> <span class=n>CARD_WIDTH</span> <span class=o>-</span> <span class=mi>2</span> <span class=o>*</span> <span class=n>margin</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>draw</span><span class=o>.</span><span class=n>text</span><span class=p>((</span><span class=n>margin</span><span class=p>,</span> <span class=n>current_y</span><span class=p>),</span> <span class=n>album_header</span><span class=p>,</span> <span class=n>fill</span><span class=o>=</span><span class=n>text_primary</span><span class=p>,</span> <span class=n>font</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>fonts</span><span class=p>[</span><span class=s1>&#39;title&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>        <span class=n>current_y</span> <span class=o>+=</span> <span class=mi>50</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># L√≠nea separadora</span>
</span></span><span class=line><span class=cl>        <span class=n>separator_color</span> <span class=o>=</span> <span class=n>ColorAnalyzer</span><span class=o>.</span><span class=n>get_border_color</span><span class=p>(</span><span class=n>bg_color</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>draw</span><span class=o>.</span><span class=n>line</span><span class=p>([(</span><span class=n>margin</span><span class=p>,</span> <span class=n>current_y</span><span class=p>),</span> <span class=p>(</span><span class=n>CARD_WIDTH</span> <span class=o>-</span> <span class=n>margin</span><span class=p>,</span> <span class=n>current_y</span><span class=p>)],</span> <span class=n>fill</span><span class=o>=</span><span class=n>separator_color</span><span class=p>,</span> <span class=n>width</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>current_y</span> <span class=o>+=</span> <span class=mi>20</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Calcular espacio disponible para pistas (m√°s margen para evitar corte de QR codes)</span>
</span></span><span class=line><span class=cl>        <span class=n>qr_section_height</span> <span class=o>=</span> <span class=mi>180</span>  <span class=c1># Aumentado para evitar que se corten los QR codes</span>
</span></span><span class=line><span class=cl>        <span class=n>available_height</span> <span class=o>=</span> <span class=n>CARD_HEIGHT</span> <span class=o>-</span> <span class=n>current_y</span> <span class=o>-</span> <span class=n>qr_section_height</span> <span class=o>-</span> <span class=n>margin</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Lista de pistas</span>
</span></span><span class=line><span class=cl>        <span class=n>track_height</span> <span class=o>=</span> <span class=mi>26</span>
</span></span><span class=line><span class=cl>        <span class=n>max_tracks</span> <span class=o>=</span> <span class=nb>max</span><span class=p>(</span><span class=mi>1</span><span class=p>,</span> <span class=n>available_height</span> <span class=o>//</span> <span class=n>track_height</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>tracks_to_show</span> <span class=o>=</span> <span class=nb>min</span><span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>album_info</span><span class=o>.</span><span class=n>tracks</span><span class=p>),</span> <span class=n>max_tracks</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>i</span> <span class=ow>in</span> <span class=nb>range</span><span class=p>(</span><span class=n>tracks_to_show</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>track</span> <span class=o>=</span> <span class=n>album_info</span><span class=o>.</span><span class=n>tracks</span><span class=p>[</span><span class=n>i</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># N√∫mero de pista</span>
</span></span><span class=line><span class=cl>            <span class=n>track_num</span> <span class=o>=</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>track</span><span class=p>[</span><span class=s1>&#39;number&#39;</span><span class=p>]</span><span class=si>:</span><span class=s2>02d</span><span class=si>}</span><span class=s2>.&#34;</span>
</span></span><span class=line><span class=cl>            <span class=n>draw</span><span class=o>.</span><span class=n>text</span><span class=p>((</span><span class=n>margin</span><span class=p>,</span> <span class=n>current_y</span><span class=p>),</span> <span class=n>track_num</span><span class=p>,</span> <span class=n>fill</span><span class=o>=</span><span class=n>text_secondary</span><span class=p>,</span> <span class=n>font</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>fonts</span><span class=p>[</span><span class=s1>&#39;track&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># T√≠tulo de la pista</span>
</span></span><span class=line><span class=cl>            <span class=n>title_x</span> <span class=o>=</span> <span class=n>margin</span> <span class=o>+</span> <span class=mi>40</span>
</span></span><span class=line><span class=cl>            <span class=n>max_title_width</span> <span class=o>=</span> <span class=n>CARD_WIDTH</span> <span class=o>-</span> <span class=n>title_x</span> <span class=o>-</span> <span class=n>margin</span>
</span></span><span class=line><span class=cl>            <span class=n>title</span> <span class=o>=</span> <span class=bp>self</span><span class=o>.</span><span class=n>_truncate_text</span><span class=p>(</span><span class=n>draw</span><span class=p>,</span> <span class=n>track</span><span class=p>[</span><span class=s1>&#39;title&#39;</span><span class=p>],</span> <span class=bp>self</span><span class=o>.</span><span class=n>fonts</span><span class=p>[</span><span class=s1>&#39;track&#39;</span><span class=p>],</span> <span class=n>max_title_width</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>draw</span><span class=o>.</span><span class=n>text</span><span class=p>((</span><span class=n>title_x</span><span class=p>,</span> <span class=n>current_y</span><span class=p>),</span> <span class=n>title</span><span class=p>,</span> <span class=n>fill</span><span class=o>=</span><span class=n>text_primary</span><span class=p>,</span> <span class=n>font</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>fonts</span><span class=p>[</span><span class=s1>&#39;track&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>current_y</span> <span class=o>+=</span> <span class=n>track_height</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Si hay m√°s pistas, indicar</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=nb>len</span><span class=p>(</span><span class=n>album_info</span><span class=o>.</span><span class=n>tracks</span><span class=p>)</span> <span class=o>&gt;</span> <span class=n>tracks_to_show</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>remaining</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>album_info</span><span class=o>.</span><span class=n>tracks</span><span class=p>)</span> <span class=o>-</span> <span class=n>tracks_to_show</span>
</span></span><span class=line><span class=cl>            <span class=n>draw</span><span class=o>.</span><span class=n>text</span><span class=p>((</span><span class=n>margin</span><span class=p>,</span> <span class=n>current_y</span><span class=p>),</span> <span class=sa>f</span><span class=s2>&#34;... y </span><span class=si>{</span><span class=n>remaining</span><span class=si>}</span><span class=s2> pistas m√°s&#34;</span><span class=p>,</span> <span class=n>fill</span><span class=o>=</span><span class=n>text_secondary</span><span class=p>,</span> <span class=n>font</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>fonts</span><span class=p>[</span><span class=s1>&#39;info&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>            <span class=n>current_y</span> <span class=o>+=</span> <span class=mi>25</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Secci√≥n de c√≥digos QR</span>
</span></span><span class=line><span class=cl>        <span class=n>qr_y_start</span> <span class=o>=</span> <span class=n>CARD_HEIGHT</span> <span class=o>-</span> <span class=n>qr_section_height</span> <span class=o>+</span> <span class=mi>25</span>  <span class=c1># M√°s margen superior para mejor posicionamiento</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># L√≠nea separadora antes de los QR codes</span>
</span></span><span class=line><span class=cl>        <span class=n>draw</span><span class=o>.</span><span class=n>line</span><span class=p>([(</span><span class=n>margin</span><span class=p>,</span> <span class=n>qr_y_start</span> <span class=o>-</span> <span class=mi>15</span><span class=p>),</span> <span class=p>(</span><span class=n>CARD_WIDTH</span> <span class=o>-</span> <span class=n>margin</span><span class=p>,</span> <span class=n>qr_y_start</span> <span class=o>-</span> <span class=mi>15</span><span class=p>)],</span> 
</span></span><span class=line><span class=cl>                 <span class=n>fill</span><span class=o>=</span><span class=n>separator_color</span><span class=p>,</span> <span class=n>width</span><span class=o>=</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Generar y colocar c√≥digos QR</span>
</span></span><span class=line><span class=cl>        <span class=n>qr_size</span> <span class=o>=</span> <span class=mi>120</span>  <span class=c1># Duplicado de 60 a 120</span>
</span></span><span class=line><span class=cl>        <span class=n>qr_spacing</span> <span class=o>=</span> <span class=mi>20</span>
</span></span><span class=line><span class=cl>        <span class=n>label_height</span> <span class=o>=</span> <span class=mi>30</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>qr_codes</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=n>qr_labels</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># QR Wikipedia del artista</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>album_info</span><span class=o>.</span><span class=n>qr_links</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;wikipedia_artist&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>qr_wiki</span> <span class=o>=</span> <span class=n>QRCodeGenerator</span><span class=o>.</span><span class=n>create_qr_code</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>album_info</span><span class=o>.</span><span class=n>qr_links</span><span class=p>[</span><span class=s1>&#39;wikipedia_artist&#39;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>                <span class=n>size</span><span class=o>=</span><span class=n>qr_size</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=n>bg_color</span><span class=o>=</span><span class=n>bg_color</span><span class=p>,</span>  <span class=c1># Usar color de fondo de la tarjeta</span>
</span></span><span class=line><span class=cl>                <span class=n>fg_color</span><span class=o>=</span><span class=n>text_primary</span>  <span class=c1># Usar color de texto primario para contraste</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>qr_wiki</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>qr_codes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>qr_wiki</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>qr_labels</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;Wikipedia&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># QR Genius del √°lbum</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>album_info</span><span class=o>.</span><span class=n>qr_links</span><span class=o>.</span><span class=n>get</span><span class=p>(</span><span class=s1>&#39;genius_album&#39;</span><span class=p>):</span>
</span></span><span class=line><span class=cl>            <span class=n>qr_genius</span> <span class=o>=</span> <span class=n>QRCodeGenerator</span><span class=o>.</span><span class=n>create_qr_code</span><span class=p>(</span>
</span></span><span class=line><span class=cl>                <span class=n>album_info</span><span class=o>.</span><span class=n>qr_links</span><span class=p>[</span><span class=s1>&#39;genius_album&#39;</span><span class=p>],</span> 
</span></span><span class=line><span class=cl>                <span class=n>size</span><span class=o>=</span><span class=n>qr_size</span><span class=p>,</span> 
</span></span><span class=line><span class=cl>                <span class=n>bg_color</span><span class=o>=</span><span class=n>bg_color</span><span class=p>,</span>  <span class=c1># Usar color de fondo de la tarjeta</span>
</span></span><span class=line><span class=cl>                <span class=n>fg_color</span><span class=o>=</span><span class=n>text_primary</span>  <span class=c1># Usar color de texto primario para contraste</span>
</span></span><span class=line><span class=cl>            <span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>qr_genius</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>qr_codes</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>qr_genius</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>qr_labels</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=s2>&#34;Letras&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Colocar los QR codes horizontalmente con nuevo orden</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>qr_codes</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>total_qr_width</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>qr_codes</span><span class=p>)</span> <span class=o>*</span> <span class=n>qr_size</span> <span class=o>+</span> <span class=p>(</span><span class=nb>len</span><span class=p>(</span><span class=n>qr_codes</span><span class=p>)</span> <span class=o>-</span> <span class=mi>1</span><span class=p>)</span> <span class=o>*</span> <span class=n>qr_spacing</span>
</span></span><span class=line><span class=cl>            <span class=n>qr_start_x</span> <span class=o>=</span> <span class=p>(</span><span class=n>CARD_WIDTH</span> <span class=o>-</span> <span class=n>total_qr_width</span><span class=p>)</span> <span class=o>//</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=c1># Primero dibujar las etiquetas ARRIBA de los QR codes</span>
</span></span><span class=line><span class=cl>            <span class=n>label_y</span> <span class=o>=</span> <span class=n>qr_y_start</span> <span class=o>+</span> <span class=mi>5</span>  <span class=c1># Etiquetas en la parte superior</span>
</span></span><span class=line><span class=cl>            <span class=n>qr_y</span> <span class=o>=</span> <span class=n>label_y</span> <span class=o>+</span> <span class=mi>25</span>      <span class=c1># QR codes debajo de las etiquetas</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>for</span> <span class=n>i</span><span class=p>,</span> <span class=p>(</span><span class=n>qr_code</span><span class=p>,</span> <span class=n>label</span><span class=p>)</span> <span class=ow>in</span> <span class=nb>enumerate</span><span class=p>(</span><span class=nb>zip</span><span class=p>(</span><span class=n>qr_codes</span><span class=p>,</span> <span class=n>qr_labels</span><span class=p>)):</span>
</span></span><span class=line><span class=cl>                <span class=n>qr_x</span> <span class=o>=</span> <span class=n>qr_start_x</span> <span class=o>+</span> <span class=n>i</span> <span class=o>*</span> <span class=p>(</span><span class=n>qr_size</span> <span class=o>+</span> <span class=n>qr_spacing</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># Etiqueta ARRIBA del QR</span>
</span></span><span class=line><span class=cl>                <span class=n>bbox</span> <span class=o>=</span> <span class=n>draw</span><span class=o>.</span><span class=n>textbbox</span><span class=p>((</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span> <span class=n>label</span><span class=p>,</span> <span class=n>font</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>fonts</span><span class=p>[</span><span class=s1>&#39;info&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                <span class=n>text_width</span> <span class=o>=</span> <span class=n>bbox</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>-</span> <span class=n>bbox</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>                <span class=n>label_x</span> <span class=o>=</span> <span class=n>qr_x</span> <span class=o>+</span> <span class=p>(</span><span class=n>qr_size</span> <span class=o>-</span> <span class=n>text_width</span><span class=p>)</span> <span class=o>//</span> <span class=mi>2</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=n>draw</span><span class=o>.</span><span class=n>text</span><span class=p>((</span><span class=n>label_x</span><span class=p>,</span> <span class=n>label_y</span><span class=p>),</span> <span class=n>label</span><span class=p>,</span> <span class=n>fill</span><span class=o>=</span><span class=n>text_secondary</span><span class=p>,</span> <span class=n>font</span><span class=o>=</span><span class=bp>self</span><span class=o>.</span><span class=n>fonts</span><span class=p>[</span><span class=s1>&#39;info&#39;</span><span class=p>])</span>
</span></span><span class=line><span class=cl>                
</span></span><span class=line><span class=cl>                <span class=c1># QR code DEBAJO de la etiqueta</span>
</span></span><span class=line><span class=cl>                <span class=n>image</span><span class=o>.</span><span class=n>paste</span><span class=p>(</span><span class=n>qr_code</span><span class=p>,</span> <span class=p>(</span><span class=n>qr_x</span><span class=p>,</span> <span class=n>qr_y</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Borde sutil de la tarjeta</span>
</span></span><span class=line><span class=cl>        <span class=n>draw</span><span class=o>.</span><span class=n>rectangle</span><span class=p>([</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>,</span> <span class=n>CARD_WIDTH</span><span class=o>-</span><span class=mi>1</span><span class=p>,</span> <span class=n>CARD_HEIGHT</span><span class=o>-</span><span class=mi>1</span><span class=p>],</span> <span class=n>outline</span><span class=o>=</span><span class=n>border_color</span><span class=p>,</span> <span class=n>width</span><span class=o>=</span><span class=mi>2</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>image</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_wrap_text</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>draw</span><span class=p>,</span> <span class=n>text</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>font</span><span class=p>,</span> <span class=n>max_width</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=n>List</span><span class=p>[</span><span class=nb>str</span><span class=p>]:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Divide el texto en l√≠neas que caben en el ancho m√°ximo&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>words</span> <span class=o>=</span> <span class=n>text</span><span class=o>.</span><span class=n>split</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>lines</span> <span class=o>=</span> <span class=p>[]</span>
</span></span><span class=line><span class=cl>        <span class=n>current_line</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>for</span> <span class=n>word</span> <span class=ow>in</span> <span class=n>words</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>test_line</span> <span class=o>=</span> <span class=n>current_line</span> <span class=o>+</span> <span class=s2>&#34; &#34;</span> <span class=o>+</span> <span class=n>word</span> <span class=k>if</span> <span class=n>current_line</span> <span class=k>else</span> <span class=n>word</span>
</span></span><span class=line><span class=cl>            <span class=n>bbox</span> <span class=o>=</span> <span class=n>draw</span><span class=o>.</span><span class=n>textbbox</span><span class=p>((</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span> <span class=n>test_line</span><span class=p>,</span> <span class=n>font</span><span class=o>=</span><span class=n>font</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>text_width</span> <span class=o>=</span> <span class=n>bbox</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>-</span> <span class=n>bbox</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>text_width</span> <span class=o>&lt;=</span> <span class=n>max_width</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=n>current_line</span> <span class=o>=</span> <span class=n>test_line</span>
</span></span><span class=line><span class=cl>            <span class=k>else</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>if</span> <span class=n>current_line</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                    <span class=n>lines</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>current_line</span><span class=p>)</span>
</span></span><span class=line><span class=cl>                <span class=n>current_line</span> <span class=o>=</span> <span class=n>word</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>current_line</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>lines</span><span class=o>.</span><span class=n>append</span><span class=p>(</span><span class=n>current_line</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>lines</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>def</span> <span class=nf>_truncate_text</span><span class=p>(</span><span class=bp>self</span><span class=p>,</span> <span class=n>draw</span><span class=p>,</span> <span class=n>text</span><span class=p>:</span> <span class=nb>str</span><span class=p>,</span> <span class=n>font</span><span class=p>,</span> <span class=n>max_width</span><span class=p>:</span> <span class=nb>int</span><span class=p>)</span> <span class=o>-&gt;</span> <span class=nb>str</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=s2>&#34;&#34;&#34;Trunca el texto para que quepa en el ancho m√°ximo&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>bbox</span> <span class=o>=</span> <span class=n>draw</span><span class=o>.</span><span class=n>textbbox</span><span class=p>((</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span> <span class=n>text</span><span class=p>,</span> <span class=n>font</span><span class=o>=</span><span class=n>font</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>text_width</span> <span class=o>=</span> <span class=n>bbox</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>-</span> <span class=n>bbox</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>text_width</span> <span class=o>&lt;=</span> <span class=n>max_width</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=k>return</span> <span class=n>text</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Truncar con &#34;...&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>ellipsis</span> <span class=o>=</span> <span class=s2>&#34;...&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>max_chars</span> <span class=o>=</span> <span class=nb>len</span><span class=p>(</span><span class=n>text</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>while</span> <span class=n>max_chars</span> <span class=o>&gt;</span> <span class=mi>0</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>truncated</span> <span class=o>=</span> <span class=n>text</span><span class=p>[:</span><span class=n>max_chars</span><span class=p>]</span> <span class=o>+</span> <span class=n>ellipsis</span>
</span></span><span class=line><span class=cl>            <span class=n>bbox</span> <span class=o>=</span> <span class=n>draw</span><span class=o>.</span><span class=n>textbbox</span><span class=p>((</span><span class=mi>0</span><span class=p>,</span> <span class=mi>0</span><span class=p>),</span> <span class=n>truncated</span><span class=p>,</span> <span class=n>font</span><span class=o>=</span><span class=n>font</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>text_width</span> <span class=o>=</span> <span class=n>bbox</span><span class=p>[</span><span class=mi>2</span><span class=p>]</span> <span class=o>-</span> <span class=n>bbox</span><span class=p>[</span><span class=mi>0</span><span class=p>]</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=k>if</span> <span class=n>text_width</span> <span class=o>&lt;=</span> <span class=n>max_width</span><span class=p>:</span>
</span></span><span class=line><span class=cl>                <span class=k>return</span> <span class=n>truncated</span>
</span></span><span class=line><span class=cl>            
</span></span><span class=line><span class=cl>            <span class=n>max_chars</span> <span class=o>-=</span> <span class=mi>1</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>return</span> <span class=n>ellipsis</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>def</span> <span class=nf>main</span><span class=p>():</span>
</span></span><span class=line><span class=cl>    <span class=s2>&#34;&#34;&#34;Funci√≥n principal&#34;&#34;&#34;</span>
</span></span><span class=line><span class=cl>    <span class=n>parser</span> <span class=o>=</span> <span class=n>argparse</span><span class=o>.</span><span class=n>ArgumentParser</span><span class=p>(</span><span class=n>description</span><span class=o>=</span><span class=s2>&#34;Generador de Tarjetas de √Ålbumes&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;folder&#34;</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s2>&#34;Carpeta que contiene los archivos del √°lbum&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;-o&#34;</span><span class=p>,</span> <span class=s2>&#34;--output&#34;</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s2>&#34;Carpeta de salida (por defecto: carpeta del √°lbum)&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=n>parser</span><span class=o>.</span><span class=n>add_argument</span><span class=p>(</span><span class=s2>&#34;-v&#34;</span><span class=p>,</span> <span class=s2>&#34;--verbose&#34;</span><span class=p>,</span> <span class=n>action</span><span class=o>=</span><span class=s2>&#34;store_true&#34;</span><span class=p>,</span> <span class=n>help</span><span class=o>=</span><span class=s2>&#34;Modo verboso&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>args</span> <span class=o>=</span> <span class=n>parser</span><span class=o>.</span><span class=n>parse_args</span><span class=p>()</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=n>args</span><span class=o>.</span><span class=n>verbose</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>logging</span><span class=o>.</span><span class=n>getLogger</span><span class=p>()</span><span class=o>.</span><span class=n>setLevel</span><span class=p>(</span><span class=n>logging</span><span class=o>.</span><span class=n>DEBUG</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>folder_path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>args</span><span class=o>.</span><span class=n>folder</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    <span class=k>if</span> <span class=ow>not</span> <span class=n>folder_path</span><span class=o>.</span><span class=n>exists</span><span class=p>():</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;La carpeta </span><span class=si>{</span><span class=n>folder_path</span><span class=si>}</span><span class=s2> no existe&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=n>output_path</span> <span class=o>=</span> <span class=n>Path</span><span class=p>(</span><span class=n>args</span><span class=o>.</span><span class=n>output</span><span class=p>)</span> <span class=k>if</span> <span class=n>args</span><span class=o>.</span><span class=n>output</span> <span class=k>else</span> <span class=n>folder_path</span>
</span></span><span class=line><span class=cl>    <span class=n>output_path</span><span class=o>.</span><span class=n>mkdir</span><span class=p>(</span><span class=n>parents</span><span class=o>=</span><span class=kc>True</span><span class=p>,</span> <span class=n>exist_ok</span><span class=o>=</span><span class=kc>True</span><span class=p>)</span>
</span></span><span class=line><span class=cl>    
</span></span><span class=line><span class=cl>    <span class=k>try</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=c1># Procesar archivos de m√∫sica</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Procesando archivos de m√∫sica...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>processor</span> <span class=o>=</span> <span class=n>MusicFileProcessor</span><span class=p>(</span><span class=n>folder_path</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>audio_files</span> <span class=o>=</span> <span class=n>processor</span><span class=o>.</span><span class=n>get_audio_files</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=ow>not</span> <span class=n>audio_files</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=s2>&#34;No se encontraron archivos de audio en la carpeta&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>            <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Encontrados </span><span class=si>{</span><span class=nb>len</span><span class=p>(</span><span class=n>audio_files</span><span class=p>)</span><span class=si>}</span><span class=s2> archivos de audio&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Extraer informaci√≥n del √°lbum</span>
</span></span><span class=line><span class=cl>        <span class=n>album_info</span> <span class=o>=</span> <span class=n>processor</span><span class=o>.</span><span class=n>extract_album_info</span><span class=p>(</span><span class=n>audio_files</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;√Ålbum: </span><span class=si>{</span><span class=n>album_info</span><span class=o>.</span><span class=n>artist</span><span class=si>}</span><span class=s2> - </span><span class=si>{</span><span class=n>album_info</span><span class=o>.</span><span class=n>album</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Enriquecer con MusicBrainz</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Buscando informaci√≥n en MusicBrainz...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>enricher</span> <span class=o>=</span> <span class=n>MusicBrainzEnricher</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>album_info</span> <span class=o>=</span> <span class=n>enricher</span><span class=o>.</span><span class=n>enrich_album_info</span><span class=p>(</span><span class=n>album_info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Descargar portada</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Descargando portada...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>downloader</span> <span class=o>=</span> <span class=n>CoverArtDownloader</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>album_info</span><span class=o>.</span><span class=n>cover_image</span> <span class=o>=</span> <span class=n>downloader</span><span class=o>.</span><span class=n>download_cover</span><span class=p>(</span><span class=n>album_info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Generar tarjetas</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=s2>&#34;Generando tarjetas...&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>generator</span> <span class=o>=</span> <span class=n>CardGenerator</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>front_card</span> <span class=o>=</span> <span class=n>generator</span><span class=o>.</span><span class=n>generate_front_card</span><span class=p>(</span><span class=n>album_info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>back_card</span> <span class=o>=</span> <span class=n>generator</span><span class=o>.</span><span class=n>generate_back_card</span><span class=p>(</span><span class=n>album_info</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Guardar im√°genes</span>
</span></span><span class=line><span class=cl>        <span class=n>album_name</span> <span class=o>=</span> <span class=n>album_info</span><span class=o>.</span><span class=n>album</span> <span class=ow>or</span> <span class=s2>&#34;album&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>album_name</span> <span class=o>=</span> <span class=s2>&#34;&#34;</span><span class=o>.</span><span class=n>join</span><span class=p>(</span><span class=n>c</span> <span class=k>for</span> <span class=n>c</span> <span class=ow>in</span> <span class=n>album_name</span> <span class=k>if</span> <span class=n>c</span><span class=o>.</span><span class=n>isalnum</span><span class=p>()</span> <span class=ow>or</span> <span class=n>c</span> <span class=ow>in</span> <span class=p>(</span><span class=s1>&#39; &#39;</span><span class=p>,</span> <span class=s1>&#39;-&#39;</span><span class=p>,</span> <span class=s1>&#39;_&#39;</span><span class=p>))</span><span class=o>.</span><span class=n>rstrip</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>front_path</span> <span class=o>=</span> <span class=n>output_path</span> <span class=o>/</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>album_name</span><span class=si>}</span><span class=s2>_cara_A.png&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>back_path</span> <span class=o>=</span> <span class=n>output_path</span> <span class=o>/</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>album_name</span><span class=si>}</span><span class=s2>_cara_B.png&#34;</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>front_card</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>front_path</span><span class=p>,</span> <span class=n>dpi</span><span class=o>=</span><span class=p>(</span><span class=n>DPI</span><span class=p>,</span> <span class=n>DPI</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        <span class=n>back_card</span><span class=o>.</span><span class=n>save</span><span class=p>(</span><span class=n>back_path</span><span class=p>,</span> <span class=n>dpi</span><span class=o>=</span><span class=p>(</span><span class=n>DPI</span><span class=p>,</span> <span class=n>DPI</span><span class=p>))</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Tarjetas guardadas:&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  Cara A: </span><span class=si>{</span><span class=n>front_path</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;  Cara B: </span><span class=si>{</span><span class=n>back_path</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=c1># Guardar informaci√≥n del √°lbum como JSON</span>
</span></span><span class=line><span class=cl>        <span class=n>info_path</span> <span class=o>=</span> <span class=n>output_path</span> <span class=o>/</span> <span class=sa>f</span><span class=s2>&#34;</span><span class=si>{</span><span class=n>album_name</span><span class=si>}</span><span class=s2>_info.json&#34;</span>
</span></span><span class=line><span class=cl>        <span class=n>album_data</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;artist&#34;</span><span class=p>:</span> <span class=n>album_info</span><span class=o>.</span><span class=n>artist</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;album&#34;</span><span class=p>:</span> <span class=n>album_info</span><span class=o>.</span><span class=n>album</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;date&#34;</span><span class=p>:</span> <span class=n>album_info</span><span class=o>.</span><span class=n>date</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;label&#34;</span><span class=p>:</span> <span class=n>album_info</span><span class=o>.</span><span class=n>label</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;genres&#34;</span><span class=p>:</span> <span class=n>album_info</span><span class=o>.</span><span class=n>genres</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;mbid&#34;</span><span class=p>:</span> <span class=n>album_info</span><span class=o>.</span><span class=n>mbid</span><span class=p>,</span>
</span></span><span class=line><span class=cl>            <span class=s2>&#34;tracks&#34;</span><span class=p>:</span> <span class=p>[{</span><span class=s2>&#34;number&#34;</span><span class=p>:</span> <span class=n>t</span><span class=p>[</span><span class=s2>&#34;number&#34;</span><span class=p>],</span> <span class=s2>&#34;title&#34;</span><span class=p>:</span> <span class=n>t</span><span class=p>[</span><span class=s2>&#34;title&#34;</span><span class=p>]}</span> <span class=k>for</span> <span class=n>t</span> <span class=ow>in</span> <span class=n>album_info</span><span class=o>.</span><span class=n>tracks</span><span class=p>]</span>
</span></span><span class=line><span class=cl>        <span class=p>}</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=k>with</span> <span class=nb>open</span><span class=p>(</span><span class=n>info_path</span><span class=p>,</span> <span class=s1>&#39;w&#39;</span><span class=p>,</span> <span class=n>encoding</span><span class=o>=</span><span class=s1>&#39;utf-8&#39;</span><span class=p>)</span> <span class=k>as</span> <span class=n>f</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=n>json</span><span class=o>.</span><span class=n>dump</span><span class=p>(</span><span class=n>album_data</span><span class=p>,</span> <span class=n>f</span><span class=p>,</span> <span class=n>indent</span><span class=o>=</span><span class=mi>2</span><span class=p>,</span> <span class=n>ensure_ascii</span><span class=o>=</span><span class=kc>False</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>info</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Informaci√≥n guardada en: </span><span class=si>{</span><span class=n>info_path</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        
</span></span><span class=line><span class=cl>    <span class=k>except</span> <span class=ne>Exception</span> <span class=k>as</span> <span class=n>e</span><span class=p>:</span>
</span></span><span class=line><span class=cl>        <span class=n>logger</span><span class=o>.</span><span class=n>error</span><span class=p>(</span><span class=sa>f</span><span class=s2>&#34;Error: </span><span class=si>{</span><span class=n>e</span><span class=si>}</span><span class=s2>&#34;</span><span class=p>)</span>
</span></span><span class=line><span class=cl>        <span class=k>if</span> <span class=n>args</span><span class=o>.</span><span class=n>verbose</span><span class=p>:</span>
</span></span><span class=line><span class=cl>            <span class=kn>import</span> <span class=nn>traceback</span>
</span></span><span class=line><span class=cl>            <span class=n>traceback</span><span class=o>.</span><span class=n>print_exc</span><span class=p>()</span>
</span></span><span class=line><span class=cl>        <span class=n>sys</span><span class=o>.</span><span class=n>exit</span><span class=p>(</span><span class=mi>1</span><span class=p>)</span>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl>
</span></span><span class=line><span class=cl><span class=k>if</span> <span class=vm>__name__</span> <span class=o>==</span> <span class=s2>&#34;__main__&#34;</span><span class=p>:</span>
</span></span><span class=line><span class=cl>    <span class=n>main</span><span class=p>()</span>
</span></span></code></pre></td></tr></table></div></div></section><footer class=article-footer><section class=article-tags><a href=/notas/tags/m%C3%BAsica/>M√∫sica</a>
<a href=/notas/tags/nfc/>Nfc</a></section><section class=article-copyright><svg class="icon icon-tabler icon-tabler-copyright" width="24" height="24" viewBox="0 0 24 24" stroke-width="2" stroke="currentColor" fill="none" stroke-linecap="round" stroke-linejoin="round"><path stroke="none" d="M0 0h24v24H0z"/><circle cx="12" cy="12" r="9"/><path d="M14.5 9a3.5 4 0 100 6"/></svg>
<span>Licensed under CC BY-NC-SA 4.0</span></section></footer></article><aside class=related-content--wrapper><h2 class=section-title>Contenidos relacionados</h2><div class=related-content><div class="flex article-list--tile"><article><a href=/notas/p/construir-koel-app-para-android/><div class=article-details><h2 class=article-title>Construir Koel App Para Android</h2></div></a></article><article><a href=/notas/p/megatools/><div class=article-details><h2 class=article-title>Megatools</h2></div></a></article><article><a href=/notas/p/instala-lazyvim-en-raspberry/><div class=article-details><h2 class=article-title>Instala Lazyvim En Raspberry</h2></div></a></article><article><a href=/notas/p/atuin.-historial-de-comandos-con-superpoderes/><div class=article-details><h2 class=article-title>Atuin. Historial De Comandos Con Superpoderes</h2></div></a></article></div></div></aside><div class=disqus-container><div id=disqus_thread></div><script>window.disqus_config=function(){},function(){if(["localhost","127.0.0.1"].indexOf(window.location.hostname)!=-1){document.getElementById("disqus_thread").innerHTML="Disqus comments not available by default when the website is previewed locally.";return}var t=document,e=t.createElement("script");e.async=!0,e.src="//hugo-theme-stack.disqus.com/embed.js",e.setAttribute("data-timestamp",+new Date),(t.head||t.body).appendChild(e)}()</script><noscript>Please enable JavaScript to view the <a href=https://disqus.com/?ref_noscript>comments powered by Disqus.</a></noscript><a href=https://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div><style>.disqus-container{background-color:var(--card-background);border-radius:var(--card-border-radius);box-shadow:var(--shadow-l1);padding:var(--card-padding)}</style><script>window.addEventListener("onColorSchemeChange",e=>{typeof DISQUS=="object"&&DISQUS.reset({reload:!0})})</script><footer class=site-footer><section class=copyright>&copy;
2020 -
2026 memoria digital</section><section class=powerby>Creado con <a href=https://gohugo.io/ target=_blank rel=noopener>Hugo</a><br>Tema <b><a href=https://github.com/CaiJimmy/hugo-theme-stack target=_blank rel=noopener data-version=3.33.0>Stack</a></b> dise√±ado por <a href=https://jimmycai.com target=_blank rel=noopener>Jimmy</a></section></footer><div class=pswp tabindex=-1 role=dialog aria-hidden=true><div class=pswp__bg></div><div class=pswp__scroll-wrap><div class=pswp__container><div class=pswp__item></div><div class=pswp__item></div><div class=pswp__item></div></div><div class="pswp__ui pswp__ui--hidden"><div class=pswp__top-bar><div class=pswp__counter></div><button class="pswp__button pswp__button--close" title="Close (Esc)"></button>
<button class="pswp__button pswp__button--share" title=Share></button>
<button class="pswp__button pswp__button--fs" title="Toggle fullscreen"></button>
<button class="pswp__button pswp__button--zoom" title="Zoom in/out"></button><div class=pswp__preloader><div class=pswp__preloader__icn><div class=pswp__preloader__cut><div class=pswp__preloader__donut></div></div></div></div></div><div class="pswp__share-modal pswp__share-modal--hidden pswp__single-tap"><div class=pswp__share-tooltip></div></div><button class="pswp__button pswp__button--arrow--left" title="Previous (arrow left)">
</button>
<button class="pswp__button pswp__button--arrow--right" title="Next (arrow right)"></button><div class=pswp__caption><div class=pswp__caption__center></div></div></div></div></div><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.js integrity="sha256-ePwmChbbvXbsO02lbM3HoHbSHTHFAeChekF1xKJdleo=" crossorigin=anonymous defer></script><script src=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe-ui-default.min.js integrity="sha256-UKkzOn/w1mBxRmLLGrSeyB4e1xbrp4xylgAWb3M42pU=" crossorigin=anonymous defer></script><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/default-skin/default-skin.min.css crossorigin=anonymous><link rel=stylesheet href=https://cdn.jsdelivr.net/npm/photoswipe@4.1.3/dist/photoswipe.min.css crossorigin=anonymous></main></div><script src=https://cdn.jsdelivr.net/npm/node-vibrant@3.1.6/dist/vibrant.min.js integrity="sha256-awcR2jno4kI5X0zL8ex0vi2z+KMkF24hUW8WePSA9HM=" crossorigin=anonymous></script><script type=text/javascript src=/notas/ts/main.c922af694cc257bf1ecc41c0dd7b0430f9114ec280ccf67cd2c6ad55f5316c4e.js defer></script><script>(function(){const e=document.createElement("link");e.href="https://fonts.googleapis.com/css2?family=Lato:wght@300;400;700&display=swap",e.type="text/css",e.rel="stylesheet",document.head.appendChild(e)})()</script></body></html>